---
title: 病院から地域システムへのデータの転送 | Microsoft Docs
description: SFTP サーバーを使用して病院から地域のソリューションにデータを転送する方法について説明します。
author: pankajarora-msft
manager: annbe
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 06/10/2020
ms.author: pankar
ms.reviewer: kvivek
searchScope:
- PowerApps
ms.openlocfilehash: 6673916552c4382f1d3c3f096c87c9730bdf61b1
ms.sourcegitcommit: 6e4a8cc9ddfb0ceb894fe7fbd626021633033907
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2020
ms.locfileid: "3443200"
---
# <a name="transfer-data-from-hospital-to-regional-system"></a>病院から地域システムへのデータの転送

Microsoft は、緊急時対応のために次のソリューションを提供しています:

- *病院緊急時対応ソリューション* を使用すると、**病院レベル** で使用可能なベッドや消耗品、COVID-19 関連の患者、スタッフ配置、および退院保留の状況を把握するためのデータを収集できます。

- *地方自治体の緊急時対応と監視ソリューション* を使用すると、**地域の保健機関レベル** で使用可能なベッドや消耗品、COVID-19 関連の患者、スタッフ配置、および退院保留の状況を把握するためのデータを収集できます。 地域機関の管轄下にある各病院は、*地方自治体の緊急時対応と監視ソリューション* の一部である地域機関のポータルを使用してデータを送信できます。

病院緊急時対応ソリューションの顧客は、地方自治体の緊急時対応および監視ソリューションを持つ地域の医療機関に病院データを転送できます。

すぐに使用できるソリューションでは、データ転送メカニズムとしてセキュア ファイル転送プロトコル (SFTP) を使用します。 顧客は、[CSV ファイルとしてデータをインポートおよびエクスポート](/powerapps/maker/common-data-service/data-platform-import-export) と [Web サービスの使用](/powerapps/developer/common-data-service/work-with-data-cds) などの他の方法を使用して、これらのソリューションとの間でデータを転送し、これらのソリューションの基礎となるデータ ストアである Common Data Service のデータをプログラムで操作できます。

この記事では、SFTP を使用してデータ転送を行う方法について説明します。

## <a name="how-does-the-data-transfer-happen"></a>データ転送はどのように行われますか?

データ転送は次のように行われます:

1. 病院は、ベッド、消耗品、設備、スタッフなど病院ソリューションからのデータを、地域の医療機関がホストする SFTP サーバーのフォルダーに公開できます。 病院はオンデマンドでデータを公開したり、スケジュールしたりできます。

2. SFTP サーバー上のフォルダーに公開された病院データは、地域ソリューションに自動的にダウンロードされ、地域ソリューションで病院のそれぞれのデータ レコード (ベッド、消耗品、設備、スタッフ) を作成するために使用されます。

## <a name="prerequisites"></a>前提条件

これらは、データ転送が正常に機能するための前提条件です。

- **SFTP サーバー**: 地域の保健機関では、病院がデータを公開できる SFTP サーバー上の各病院用のフォルダーで SFTP サーバーを構成する必要があります。 病院は、SFTP サーバー上のフォルダーに接続するために、地域の保健機関から資格情報を取得する必要があります。<br/>
SFTP サーバーの作成については、[Azure 上の SFTP](https://docs.microsoft.com/samples/azure-samples/sftp-creation-template/sftp-on-azure/) を参照してください

- **CDC の短縮名**: **消耗品** と **スタッフ配置の種類** の各レコードには **CDC の短縮名** 値が必要です。 これらのレコードを病院と地域のソリューションの **管理アプリ** で作成および管理できます。

- **DOH 番号**: 各 **設備** レコードには、有効な **DOH 番号** 値が必要です。 これらのレコードを病院と地域のソリューションの **管理アプリ** で作成および管理できます。

## <a name="configure-your-solutions-for-data-transfer"></a>データ転送のためのソリューションを構成する

IT 管理者は、病院緊急時対応ソリューションから SFTP サーバーへ、および SFTP サーバーから地方自治体の緊急時対応および監視ソリューションへのデータ転送を構成するために、いくつかの手順を実行する必要があります。

> - [ステップ 1: 接続を作成する](#step-1-create-connections)
> - [ステップ 2: データを SFTP (病院) に公開するフローを有効にする](#step-2-enable-flows-for-publishing-data-to-sftp-hospital)
> - [ステップ 3: データ公開スケジュールを指定する (病院)](#step-3-specify-the-data-publish-schedule-hospital)
> - [ステップ 4: SFTP (地域) から病院データをプルするフローを有効にする](#step-4-enable-flow-for-pulling-hospital-data-from-sftp-regional)

### <a name="step-1-create-connections"></a>ステップ 1: 接続を作成する

病院と地域のシステムの両方が Power Automate フローを使用して、病院/地域ソリューションと SFTP サーバー間でデータを転送します。 このステップでは、フローでデータ転送に使用される Common Data Service と SFTP の接続を作成します。

このステップは、病院と地域の両方のソリューションに必要です。

> [!IMPORTANT]
> 病院および地域の緊急時対応ソリューションをインストールあるいは最新バージョンにアップグレードする前に Power Apps 環境で必ず接続を作成してください。 これにより、これらのソリューションの一部としてインストールされるフローを有効にしながら、後で多くの手順を節約できます。 

1. [Power Apps](https://make.powerapps.com) にサインインします。

1. 右上隅から、病院または地域の環境を選択します。

1. 左側のナビゲーション ウィンドウから、**データ** を展開し、**接続** を選択します。

1. **新しい接続** を選択し、検索ボックスに **Common Data Service** と入力します。 

1. 検索結果から、**Common Data Service** コネクタの横の **+** を選択し、接続を追加します。

    > [!div class="mx-imgBorder"] 
    > ![Common Data Service コネクタ](media/cds-connector.png)

1. 次の画面で **作成** を選択します。 資格情報を選択または指定して、コネクタを作成します。 認証に成功すると、接続が作成されます。

1. **新しい接続** を選択し、検索ボックスに **Common Data Service** と入力します。

1. 検索結果から、**Common Data Service (現在の環境)** コネクタの横の **+** を選択し、接続を追加します。

1. 次の画面で **作成** を選択します。 資格情報を選択または指定して、コネクタを作成します。 認証に成功すると、接続が作成されます。

1. **新しい接続** を選択し、検索ボックスに **SFTP** と入力します。

1. 検索結果から、**SFTP - SSH** コネクタの横の **+** を選択し、接続を追加します。

    > [!div class="mx-imgBorder"] 
    > ![SFTP コネクタ](media/sftp-connector.png)

1. **SFTP - SSH** ダイアログ ボックスで、SFTP サーバー上のフォルダーに接続するための資格情報を入力します。 これらの詳細は、**前提条件** セクションで前述したように、地域の保健機関からすでに提供されているはずです。

1. **作成**を選びます。 Power Apps は接続の詳細を検証し、認証が成功すると、SFTP 接続を作成します。

このステップの最後には、3 つの接続が必要です: Common Data Service 用に 2 つ、SFTP 用に 1 つです。

### <a name="step-2-enable-flows-for-publishing-data-to-sftp-hospital"></a>ステップ 2: データを SFTP (病院) に公開するフローを有効にする

この手順は、病院緊急時対応ソリューションの管理者がソリューションをインストールした後に実行する必要があります。

このステップでは、病院ソリューションから SFTP サーバーにレビュー済みデータを設定されたスケジュールでオンデマンドで公開する次のフローを有効にします:
- ベッド全数調査のデータの公開
- COVID のデータの公開
- すべての設備のデータの公開
- 機器のニーズのデータの公開
- スタッフの更新の公開
- 消耗品の項目の詳細の公開
- 全数調査の同期の更新
- 機器のニーズの同期の更新

これらのフローを有効にするには:

1.  [Power Automate](https://flow.microsoft.com/) にサインインする。

1.  左側のウィンドウから、**ソリューション** を選択します。 ソリューションのリストから、**地域の緊急時対応ソリューション**を選択し、ソリューションを開きます。

1.  ソリューションでは、**フロー**でフィルター処理し、すべてのフローを検索します。

    > [!div class="mx-imgBorder"] 
    > ![すべてのフロー](media/all-flows-hospital.png)

1.  フロー名を選択してフロー定義を開きます。 たとえば、**ベッド全数調査のデータの公開** を選択します。 

1.  ツールバーで **編集** を選択して、このフローの埋め込み接続を確認します。 これらは、以前に作成した接続と同じでなければなりません。

1.  **保存**を選択して変更の保存を行い、**有効にする**を選択します。

1.  上記のその他のフローについて、ステップ 4-6 を繰り返します。

フローの操作で問題が発生した場合は、[フローのトラブルシューティング](https://docs.microsoft.com/power-automate/fix-flow-failures) を試してください。

### <a name="step-3-specify-the-data-publish-schedule-hospital"></a>ステップ 3: データ公開スケジュールを指定する (病院)

**すべての設備のデータの公開** フローには、データ公開スケジュールに関する情報が含まれています。 フローが自動的に実行され、確認して公開の準備ができたとマークしたデータを公開するときの定期スケジュールを定義できます。  

1.  [Power Automate](https://flow.microsoft.com/) にサインインする。

1.  左側のウィンドウから、**ソリューション** を選択します。 ソリューションのリストから、**地域の緊急時対応ソリューション**を選択し、ソリューションを開きます。

1.  ソリューションで、「のデータの公開」 を検索します。 **すべての設備のデータの公開** フローが検索結果に表示されます。

    > [!div class="mx-imgBorder"] 
    > ![すべての設備のデータの公開フロー](media/publish-all-data-flow.png)

1.  フロー名を選択してフロー定義を開き、ツールバーで **編集** を選択します。

1.  フロー定義で、**繰り返し** を選択して、**編集** を選択します。

    > [!div class="mx-imgBorder"] 
    > ![データ公開定期スケジュールを更新する](media/update-publish-schedule1.png)

1. データ公開定期スケジュールを指定します。 

    > [!div class="mx-imgBorder"] 
    > ![データ公開定期スケジュールを更新する](media/update-publish-schedule2.png)

1.  **保存**を選択して、変更を保存します。

### <a name="step-4-enable-flow-for-pulling-hospital-data-from-sftp-regional"></a>ステップ 4: SFTP (地域) から病院データをプルするフローを有効にする

この手順は、地方自治体の緊急時対応および監視ソリューションの管理者が実行する必要があります。

このステップでは、SFTP サーバーの病院システムからアップロードされたデータに基づいて、地域ソリューションで病院のレコードを自動的に作成する **SFTP の場所にファイルを作成するときにレコードを作成する** フローを有効にします。

> [!IMPORTANT]
> 地域機関に登録してデータを送信する病院ごとに、地域管理者は次のいずれかを実行して、各病院のデータが SFTP サーバーから地域ソリューションにコピーされるようにする必要があります。
>
> - すべての病院からのデータを SFTP サーバー上の単一のフォルダーにコピーして、**SFTP の場所にファイルを作成するときにレコードを作成する** フローがすべてのデータをコピーできるようにします。
>
> - データを送信するために登録する各病院に **SFTP の場所にファイルを作成するときにレコードを作成する** フローのコピーを作成し、各フロー インスタンスで、病院ごとに SFTP サーバー フォルダーのパスを変更します。 この方法については、このセクションの後半で説明します。

1.  [Power Automate](https://flow.microsoft.com/) にサインインする。

1.  左側のウィンドウから、**ソリューション** を選択します。 ソリューション リストから、**地域の緊急時対応ソリューション**を選択し、ソリューションを開きます。

1.  ソリューションでは、**フロー**でフィルター処理し、すべてのフローを検索します。

    > [!div class="mx-imgBorder"] 
    > ![アプリのフロー](media/conf-all-flows.png "アプリのフロー")

1.  **SFTP の場所にファイルを作成するときにレコードを作成する** フローを選択し、フロー定義を開きます。 

1.  このフローの組み込み接続を確認します。 これらは、以前に作成した接続と同じでなければなりません。 

1.  **保存**を選択して変更の保存を行い、**有効にする**を選択します。

1.  地域の管理者が SFTP サーバー上の異なるフォルダーに保存されている複数の病院からのデータを予期している場合、**SFTP の場所にファイルを作成するときにレコードを作成する** フローのコピーを作成して、各病院ごとに 1 つ作成し、コピーされたフロー インスタンスで SFTP フォルダー名を適宜更新できます。 実行手順:

    1. ツールバーで **名前を付けて保存** を選択し、フローのコピーを作成します。
    
    1. フローの名前を適宜変更して保存します。 このフローは、**マイ フロー** で利用できるようになります。
    
    1. フローを選択して、編集用に開きます。 ツールバーで、**編集**を選択します。
    
    1. **ファイルが追加または変更されたとき** を選択して、適切な値を **フォルダ** フィールドで選択します:
        > [!div class="mx-imgBorder"] 
        > ![フローを編集する](media/edit-flow.png "フローを編集する")

1.  **保存**を選択して変更の保存を行い、**有効にする**を選択します。


## <a name="review-and-publish-data-to-sftp"></a>データを確認して SFTP に公開する

IT 管理者が病院ソリューションからデータ転送用にソリューションを構成した後、**データを確認して公開** モデル駆動型アプリを使用してデータを確認し、SFTP サーバー上のフォルダーに公開するためにデータを完了としてマークを付けることができます。

1. [Power Apps](https://make.powerapps.com) にサインインします。

1. 右上隅から、病院の環境を選択します。

1. 左側のナビゲーション ウィンドウで **アプリ** を選択し、**データを確認して公開** アプリを選択します。

1. アプリでは、すべての設備が一覧表示されます。 データを確認して公開する設備を選択します。 設備レコードが開きます。

    > [!div class="mx-imgBorder"] 
    > ![設備レビュー](media/facility-review.png)

1. ページを下にスクロールして、設備の次のデータを確認します: ベッド全数調査、COVID の統計情報、機器のニーズ、消耗品の追跡、およびスタッフの更新。 必要に応じて、グリッド内のデータを更新し、保存アイコンを選択して変更を保存します。

    > [!div class="mx-imgBorder"] 
    > ![値の更新](media/update-values.png)

1. 確認したら、データの行を選択して、**完了としてマーク** を選択できます。 確認ダイアログ ボックスで **OK** を選択して、アクションを完了します。

    レコードのレビュー ステータスが **完了** に変わります。

    > [!div class="mx-imgBorder"] 
    > ![レビュー完了](media/review-completed.png)

予定フローは、以前に構成した SFTP フォルダー ([ステップ 3: データ公開スケジュールを指定する (病院)](#step-3-specify-the-data-publish-schedule-hospital)) への公開用に完了したアイテムを取得します。

### <a name="manually-publish-data"></a>データを手動で公開する

予定フローは特定の時間にデータを公開しますが、確認した後、手動または即時にデータを公開する場合はどうでしょうか。 

1.  **データを確認して公開** アプリで、左側のペインにある **公開履歴** から公開するレコードを選択します。 選択したエンティティのすべての公開済みデータが表示されます。 エンティティのアクティブなレコードを表示する場合は、ビュー セレクターを使用します。

    > [!div class="mx-imgBorder"] 
    > ![レビュー完了](media/manual-data-publish.png)

1. この場合、前のセクションで確認したデータを公開します。 そのため、**アクティブなベッド全数調査** ビューを選択し、完了とマークされた行を選択してから、**フロー** > **ベッド全数調査のデータの公開** を選択します。

    > [!div class="mx-imgBorder"] 
    > ![フローを手動で実行する](media/manually-run-flow.png)

1. 次の画面で、接続が有効であることを確認し、**続行** を選択します。

    > [!div class="mx-imgBorder"]
    > ![フローを手動で実行する](media/publish-data-flow.png)

1. 次の画面で **フローの実行** を選択します。 フローの実行が正常に開始されたことと、進行状況の監視方法を示すメッセージが表示されます。

## <a name="issues-and-feedback"></a>問題とフィードバック

- 病院緊急時対応サンプル アプリに関する問題を報告するには、<https://aka.ms/emergency-response-issues> にアクセスしてください。

- 病院緊急時対応サンプル アプリに関するフィードバックについては、<https://aka.ms/emergency-response-feedback> にアクセスしてください。

