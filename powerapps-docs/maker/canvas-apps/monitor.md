---
title: キャンバス アプリ モニターを使用してアプリをデバッグする | Microsoft Docs
description: キャンバス アプリをデバッグするためのキャンバス アプリ モニターについて説明します。
author: aengusheaney
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: tapanm
ms.date: 06/12/2020
ms.author: aheaney
search.audienceType:
- maker
search.app:
- PowerApps
ms.openlocfilehash: 1cb8fb8e738f0ec4534ffad2517443cbe3d31e51
ms.sourcegitcommit: e8e2b7251c301f44fb60af29a86107c099a543a8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/12/2020
ms.locfileid: "3447410"
---
# <a name="debugging-an-app-with-canvas-app-monitor-preview"></a>キャンバス アプリ モニターを使用したアプリのデバッグ (プレビュー)

[この記事はプレリリース ドキュメントであり、変更されることがあります。]

**キャンバス アプリ モニター**は、問題のデバッグと診断を迅速化し、より高速で信頼性の高いアプリを構築するのに役立ちます。 モニターでは、アプリの実行時にアプリのすべてのアクティビティのログを提供することで、アプリの実行方法の詳細なビューが提供されます。

この機能により、アプリに含まれる数式がどのように機能するかをよりよく理解できるため、パフォーマンスを向上させ、エラーや問題を特定できます。

> [!IMPORTANT]
> キャンバス アプリ モニター 機能はプレビュー段階です。 詳細については [実験的機能とプレビュー機能](working-with-experimental-preview.md) を参照してください。

## <a name="debugging-an-app"></a>アプリのデバッグ

問題をデバッグする上で重要なのは、アプリの機能とその方法についてよく理解することです。場合によっては、アプリの数式を見たり、または実行時エラーを確認するだけでは問題を特定するのが難しいことがあります。 アプリで発生するイベントを監視することで、イベントとエラーの順序とパフォーマンスを理解し、問題をより迅速に診断できます。

モニターの使用時に明らかにできる問題とクエリの例は次のとおりです:

- **多数のネットワーク呼び出し**
    - アプリはデータをかなり頻繁に取得していますか ?
    - 必要なときにのみデータを取得するよう、アプリを最適化できますか ?
    - タイマー コントロールが頻繁に起動していますか ?
    - アプリの起動時に発生するイベントが多すぎませんか ? 一部のデータの取得を遅らせることはできますか ?

- **同じデータ ソースからデータを取得する**
    - 同じデータを複数回取得する代わりに、コレクションまたは変数にデータをキャッシュするなど、異なるパターンを使用できますか ?
    
-  **応答データ サイズ** – クエリ フィルターを使用して、要求されるデータの量を減らすことはできますか ?

- **要求の期間**
    - 統合は最適化されていますか ?
    - クエリ フィルターを使用して応答のサイズを削減できますか ?

- **エラー**
    - アプリを正しく実行するために必要なアクセス許可を構成しましたか ?
    - プラットフォームによってリクエストが調整されていますか ?

実行中の**モニター**を確認するには、[シナリオの例](#example) を参照してください。

## <a name="open-app-monitor-while-editing-an-app-in-power-apps-studio"></a>Power Apps Studio でアプリを編集中にアプリ モニターを開く

キャンバス アプリ モニターは、既定ですべてのキャンバス アプリに対して使用できます。 アプリを作成するときにモニターを開くには:

1.  [Power Apps](https://make.powerapps.com/) にサインインします。

1.  [新しいアプリ](https://docs.microsoft.com/powerapps/maker/canvas-apps/get-started-test-drive) を作成するか [既存のアプリを編集](https://docs.microsoft.com/powerapps/maker/canvas-apps/edit-app) します。

1. 左側のペインにある  **詳細ツール** を選択します。

1.  **モニターを開く** を選択して、このアプリのモニターを開きます。 

    ![モニターを開く](./media/monitor/open-monitor.png "モニターを開く")

このアクションは、新しいブラウザー タブでモニターを開き、既存の Studio セッションに接続します:

![キャンバス アプリ モニター](./media/monitor/canvas-app-monitor.png "キャンバス アプリ モニター")

> [!NOTE]
> モニターはアプリに影響を与えません。 モニターは、テスト環境または運用環境の任意のアプリで使用できます。

## <a name="open-app-monitor-for-published-app"></a>公開済みアプリのアプリ モニターを開く

モニターを使用して、公開済みアプリを Web プレーヤーでデバッグすることもできます。 公開済みアプリのモニターを開くには、2 つのオプションがあります。

### <a name="open-app-monitor-for-published-app-using-power-apps-studio"></a>Power Apps Studio を使用して公開済みアプリのアプリ モニターを開く

1.  [Power Apps](https://make.powerapps.com/) にサインインします。

1.  [新しいアプリ](https://docs.microsoft.com/powerapps/maker/canvas-apps/get-started-test-drive) を作成するか [既存のアプリを編集](https://docs.microsoft.com/powerapps/maker/canvas-apps/edit-app) します。

1. 左側のペインにある  **詳細ツール** を選択します。

1.  **モニターを開く** を選択して、このアプリのモニターを開きます。

1. トップ メニューから **公開済みアプリの再生** を選択します。

   ![公開済みアプリを開く](./media/monitor/play-published-app.png "公開済みアプリを開く")

   これにより、新しいブラウザー タブで公開済みアプリを開き、現在のモニター セッションに接続します。 アプリが Web プレーヤーに読み込まれたとき、および公開済みアプリを操作したときに、すぐにモニターにイベントが表示されます。

   > [!NOTE]
   > この方法で公開済みアプリを開くと、アプリが同じモニター セッションに 2 回接続されます。 Power Apps Studio で編集中のアプリと Web プレーヤーで公開されたアプリ。 両方のオプションを同時に使用してアプリを操作すると、Power Apps Studio と公開済みアプリの両方からのイベントがモニターに表示されます。

### <a name="open-app-monitor-for-published-app-from-power-apps"></a>Power Apps から公開済みアプリのアプリ モニターを開く
 
Power Apps Studio でアプリを開かなくても、公開済みアプリのモニターを開くことができます。
   
1.  [Power Apps](https://make.powerapps.com/) にサインインします。

1. 左側のペインで、**アプリ** を選択します。

1. 一覧からアプリを選択します。

1. メニューから **モニター** を選択します。 **その他のコマンド** (**...**) を選択して、代わりに **モニター** を選択することもできます。

    ![モニターを開く](./media/monitor/open-monitor-portal.png "モニターを開く")

    このアクションは、新しいブラウザー タブでモニターを開きます。

1. モニターではトップ メニューから **公開済みアプリの再生** を選択します。

    ![公開済みアプリを開く](./media/monitor/play-published-app.png "公開済みアプリを開く")

    これにより、新しいブラウザー タブで公開済みアプリを開き、現在のモニター セッションに接続します。 アプリが Web プレーヤーに読み込まれたとき、および公開済みアプリを操作したときに、すぐにモニターにイベントが表示されます。

## <a name="view-events-in-canvas-app-monitor"></a>キャンバス アプリ モニターでイベントを表示する

アプリからのイベントを表示するには、スタジオでアプリを再生します。 モニターでは、発生するイベントのテーブルが特定の詳細事項とともに表示されます。

![発生時にイベントを表示する](./media/monitor/view-events.gif "発生時にイベントを表示する")

メディアを再生するには、ページを更新します。

モニター内の各イベントのさまざまなプロパティを確認できます。 イベント カテゴリによっては、これらのプロパティの一部にデータが含まれていない場合があります。

キャンバス アプリ モニターでの列の説明:

| 列名 | 内容
| - | -
| **\#** | イベントのシーケンス番号。
| **時刻** | イベントの時刻。
| **状況** | ネットワーク要求の [HTTP ステータス コード](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)。 たとえば、2XX コードは成功した要求を表し、4XX コードはエラーを表します。
| **期間** | イベントの種類によって異なります。 たとえば、ネットワーク要求の場合、期間は要求が送信されて応答が受信されるまでにかかる時間です。 期間は、アプリでのネットワーク呼び出しのパフォーマンスを理解するのに使用できます。
| **カテゴリ** | *ネットワーク*などの、イベントの種類。
| **操作** | アプリ内の要求の結果の内部操作名。 例えば、*createRow* は **Patch** 関数からの操作名です。
| **コントロール プロパティ** | イベントを発生させたコントロール プロパティ。
| **応答サイズ** | ネットワーク要求イベントの場合、送信者からアプリに受信された応答サイズをバイト単位で表します。

グリッドでイベントを選択すると、イベントに関する追加の詳細情報を含むパネルが表示されます。 パネルには 4 つのタブがあります:

- **詳細**: 選択するイベントの高レベルの概要を表示します。一部のデータは、ツリー ビューで折りたたまれている場合があります。 展開およびドリルダウンしてコンテンツを表示できます:

    ![詳細タブ](./media/monitor/details-tab.png "詳細タブ")

- **数式**: 選択するイベントに対してアプリから関連数式を表示します。 イベントをトリガーするコントロール プロパティの名前は、タブの上部とイベント テーブル内に表示されます:

    ![数式タブ](./media/monitor/formula-tab.png "数式タブ")

- **要求**: 送信された HTTP リクエストを表示します:

    ![要求タブ](./media/monitor/request-tab.png "要求タブ")

- **応答**: 受信した HTTP 応答を表示します。 表形式または JSON 形式で応答を表示できます。 既定の形式は、データを表形式で表示できる場合は*テーブル*です:

    ![応答タブ](./media/monitor/response-tab.png "応答タブ")

    *テーブル*形式を選択する場合、テーブルおよびレコードがグリッドに表示されます。 テーブルを選択すると、テーブル内のレコードにドリルダウンできます:

    ![テーブル形式 - 応答タブ](./media/monitor/table-format-response-tab.png "テーブル形式 - 応答タブ")

    *JSON ツリー*を選択すると、コンテンツが JSON 形式で表示されます:

    ![JSON 形式 - 応答タブ](./media/monitor/json-format-response-tab.png "JSON 形式 - 応答タブ")

## <a name="collaborative-debugging"></a>共同作業デバッグ

モニター セッションに他のユーザーを招待すると、画面を共有する必要がなく、アプリを一緒にすばやく共同編集およびデバッグできます。 セッションに参加するよう他のユーザーを招待すると、アプリを開いたり、またはデバッグしている特定のシナリオを再現する必要もなく、そのユーザー個人のブラウザにまったく同じアプリ イベントが表示されます。 これにより、ユーザーや他の参加者は、お互いに踏み込んだり、コントロールを前後に動かして問題を特定したりすることなく、アプリ イベントを個別に参照、表示、および検査できます。

> [!NOTE]
> 組織内の任意のユーザーをモニター セッションに招待できます。 セッションに参加するユーザーには、任意のデータを含め、アプリによって生成されたすべてのイベントが表示されます。

1. 上部にある **招待** を選択します。

1. モニター セッションに招待するユーザーの Azure Active Directory ユーザー名またはエイリアスを入力します。

    ![ユーザーを招待](./media/monitor/invite-user.png "ユーザーを招待")

1. 現在のモニター セッションへのリンクを生成するユーザーを選択します。

    > [!NOTE]
    > リンクは各ユーザーに対して一意です。 ユーザー間で共有することはできません。 リンクは 60 分後に期限切れになります。

1. リンク アイコンを選択してセッション リンクをコピーし、セッションに招待したユーザーに送信します。

    ![セッション リンク](./media/monitor/session-link.png "セッション リンク")

受信者ユーザーは、リンクを使用してモニターを開き、モニター セッションに接続できます。

## <a name="download-and-upload-a-trace-file"></a>トレース ファイルのダウンロードとアップロード

テーブルに表示されるイベントをダウンロードして、オフラインで分析できます。 イベントは ```.json``` または ```.csv``` 形式でダウンロードでき、他のユーザーと共有できます。 ```.csv``` ファイルのみダウンロードできます。 ただし、イベントを ```.json``` 形式でエクスポートする場合、分析のためにモニター ツールに戻すことができます。 トレース ファイルを添付してサービス要求をサポートし、問題の解決を迅速化するすることもできます。

![Download](./media/monitor/Download.png "ダウンロード")

**アップロード**を選択して、```.json``` トレース ファイルをモニターに読み込みます。 アップロード オプションは、現在モニター テーブルに表示される任意のイベントを削除し、トレース ファイルに含まれるイベントの詳細に置き換えます。

![アップロードします](./media/monitor/upload.png "アップロードします")

## <a name="example"></a>例

この例では、 [Northwind サンプル ソリューション](https://docs.microsoft.com/powerapps/maker/canvas-apps/northwind-install) に含まれる *Northwind サンプル データ* アプリを使用します。

*Northwind サンプル ソリューション*はサンプル データを Common Data Service に読み込むキャンバス アプリです。 新しいアプリを作成するか、または既存のアプリを代わりに編集することもできます。

### <a name="background"></a>バックグラウンド

アプリが展開され、アプリの初期バージョンでパフォーマンスが低下するシナリオを考えてみます。 アプリはまた、明確なパターンのないエラーを断続的に生成します。 アプリへのデータの読み込みはほとんど成功し、時には失敗することもあります。

キャンバス アプリ モニターをチェックすると、期待どおりのデータ操作が表示されます。 ただし、特定の時間枠での要求が多すぎることを示す HTTP 状態コード 429 の応答もいくつか表示されます。

そのようなイベントを選択すると、*レート制限を超えました。XX 秒後にやり直してください。* というエラーが表示されます

![HTTP 状態コード 429](./media/monitor/http-statuscode-429.png "HTTP 状態コード 429")

### <a name="analysis"></a>分析

要求が調整されている理由を理解するには、問題をさらに分析する必要があります。 モニターでは、 **createRow** 呼び出しごとに、 **ProgressCount.Text** プロパティからのそれぞれ異なるエンティティに対する **getRows** 要求がいくつかあることがわかります。 これらのエンティティは、アプリが行を作成するエンティティではありません。 **ProgressCount.Text** 式はモニターに表示されます:

![ProgressCount.Text 式](./media/monitor/progresscount-text-formula.png "ProgressCount.Text 式")

追加されたレコードごとに、式が再評価され、 **CountRows** がいくつかのエンティティで呼び出されます。 **CountRows** が Common Data Service に委任されていないため、ログで **getRows** となりました。レコードを追加する単一要求ごとに、各エンティティの行をカウントする 12 の追加要求を作成している可能性があります。

Common Data Service プラットフォームはサービスへの要求を調整しているため、これらの追加要求は断続的にエラーを発生させます。 また、全体的パフォーマンスの問題についても説明します。

### <a name="conclusion"></a>まとめ

このアプリを完全に解決するには、レコードがエンティティ内で作成されているときに、エンティティごとに手動で **CountRows** を実行します。モニターを使用せずに、この問題を診断して解決することは困難でした。

### <a name="see-also"></a>関連項目

[キャンバス アプリ テスト スタジオ](test-studio.md)
