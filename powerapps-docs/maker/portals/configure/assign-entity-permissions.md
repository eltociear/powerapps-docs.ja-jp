---
title: ポータルに対するエンティティアクセス許可を使用してレコードベースのセキュリティを追加する |MicrosoftDocs
description: エンティティのアクセス許可を追加し、web ロールを割り当てる方法について説明します。
author: sbmjais
manager: shujoshi
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 11/04/2019
ms.author: shjais
ms.reviewer: ''
ms.openlocfilehash: 47730a2ba169b89534fa93221290c5598a95a8e8
ms.sourcegitcommit: d9cecdd5a35279d78aa1b6c9fc642e36a4e4612c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/04/2019
ms.locfileid: "73553396"
---
# <a name="add-record-based-security-by-using-entity-permissions-for-portals"></a>ポータルのエンティティアクセス許可を使用してレコードベースのセキュリティを追加する

ポータルのレコードベースのセキュリティを個々のレコードに適用するには、エンティティのアクセス許可を使用します。 エンティティのアクセス許可を web ロールに追加すると、エンティティのアクセス許可を使用して導入されたレコードの所有権とアクセス権の特権と概念に論理的に対応する組織のロールを定義できます。 特定の連絡先は任意の数のロールに属することができ、特定のロールには任意の数のエンティティ権限を含めることができます。 [ポータルの web ロールを作成 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] には](create-web-roles.md) 

ポータルサイトマップ内の Url を変更したりアクセスしたりするためのアクセス許可は、コンテンツの承認によって付与されますが、サイトマネージャーでは、エンティティフォームやエンティティリストを使用して構築されたカスタム web アプリケーションをセキュリティで保護することもできます。 [エンティティフォームを定義](entity-forms.md)して[エンティティリストを定義](entity-lists.md)[!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] には  

これらの機能をセキュリティで保護するために、エンティティの権限では、任意のエンティティに対して詳細な権限を付与したり、リレーションシップの定義を使用してレコードレベルのセキュリティを有効にしたりすることができます。

## <a name="add-entity-permissions-to-a-web-role"></a>Web ロールへのエンティティアクセス許可の追加

1.  [ポータル管理アプリ](configure-portal.md)を開きます。

2. [**ポータル**&gt; **web ロール**] にアクセスし、アクセス許可を追加する web ロールを開きます。 

3. **[追加]** を選択して、既存のエンティティのアクセス許可を web ロールに追加します。 

4. **[新規]** を選択して、新しいエンティティアクセス許可レコードを作成します。

    ![Web ロールへのエンティティアクセス許可の追加](../media/add-entity-permission-web-role.png "Web ロールへのエンティティアクセス許可の追加")  

新しいエンティティアクセス許可レコードを作成する場合、最初の手順は、セキュリティで保護されるエンティティを決定することです。 次の手順では、以下で説明するようにスコープを定義し、グローバル&mdash;以外のスコープに対して、そのスコープを定義するリレーションシップを&mdash;します。 最後に、このアクセス許可を使用して、ロールに付与されている権限を確認します。 権限は累積的であるため、ユーザーが読み取り権限を付与するロールにユーザーがいて、読み取りと更新を許可する別のロールがある場合、ユーザーは、2つのロールの間に重複するレコードに対する読み取り権限と更新権限を持っていることに注意してください。

> [!Note]
> Web ページや web ファイルなどの CMS エンティティの選択は無効であり、その他の意図しない結果が発生する可能性があります。 ポータルは、エンティティのアクセス許可ではなく、コンテンツアクセスコントロールに基づいて CMS エンティティのセキュリティをアサートします。

### <a name="global-scope"></a>グローバルスコープ

読み取り権限を持つエンティティ権限レコードが、グローバルスコープを持つロールに付与されている場合、そのロールのすべての連絡先は、定義されたエンティティのすべてのレコードにアクセスできます。 たとえば、すべての潜在顧客、すべてのアカウントなどを表示できるようになります。 このアクセス許可は、任意のエンティティリストによって自動的に尊重されます。基本的には、そのリストに定義されているモデル駆動型アプリビューに従ってすべてのレコードが表示されます。 さらに、ユーザーがアクセス権のないエンティティフォームを使用してレコードにアクセスしようとすると、アクセス許可エラーが発生します。

### <a name="contact-scope"></a>連絡先の範囲

連絡先スコープでは、アクセス許可レコードが定義されているロールのサインインユーザーが、定義されたリレーションシップを使用してそのユーザーの連絡先レコードに関連付けられているレコードに対してのみ、そのアクセス許可によって付与された権限を持つことになります。

エンティティリストでは、そのリストによって表示されるモデル駆動型アプリビューにフィルターが追加され、現在のユーザーに直接リンクされているレコードのみが取得されます。 (シナリオによっては、この関係は、所有権または管理権限と考えることができます)。

エンティティフォームでは、レコードの読み込み時にこのリレーションシップが存在する場合にのみ、読み取り、作成、書き込みなどに対する適切なアクセス許可が許可されます。 [ポータル内でエンティティフォームとカスタムロジックを定義](entity-forms.md)[!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] ます。  

### <a name="account-scope"></a>アカウントのスコープ

アカウントスコープでは、アクセス許可レコードが定義されているロールのサインインユーザーが、定義されたリレーションシップを使用してそのユーザーの親アカウントレコードに関連付けられているレコードに対してのみ、そのアクセス許可によって付与された権限を持つことになります。

### <a name="self-scope"></a>自己スコープ

自己スコープを使用すると、自分の連絡先 (Id) レコードに対するユーザーの権限を定義できます。 これにより、ユーザーはエンティティフォームまたは web フォームを使用して、自分のプロファイルにリンクされた独自の連絡先レコードを変更できます。 既定のプロファイルページには、任意のユーザーが基本的な連絡先情報を変更し、マーケティングリストをオプトインまたはオプトアウトできる特別な組み込みフォームが用意されています。 このフォームがポータル (既定では) に含まれている場合、ユーザーはこのフォームを使用するためにこのアクセス許可を必要としません。 ただし、ユーザーの連絡先レコードを対象とするカスタムエンティティフォームまたは web フォームを使用するには、このアクセス許可が必要です。

### <a name="parental-scope"></a>保護者の範囲

この最も複雑なケースでは、エンティティのアクセス許可レコードが既に定義されているエンティティに対する権限が付与されます。 この権限は、実際には親エンティティ権限の子レコードです。

親アクセス許可レコードは、エンティティのアクセス許可とスコープ (場合によってはグローバルまたは連絡先のスコープを定義しますが、親も可能です) を定義します。 このエンティティは、連絡先 (連絡先のスコープの場合) またはグローバルに定義された連絡先に関連付けられている場合があります。 その権限が設定されていると、親リレーションシップで定義されているエンティティと別のエンティティ間のリレーションシップを定義する子権限が作成されます。

したがって、親エンティティの権限によって定義されたレコードにアクセスできる web ロールのユーザーには、親レコードに関連するレコードの子権限レコードによって定義された権限も与えられます。

### <a name="attributes-and-relationships"></a>属性とリレーションシップ

次の表では、エンティティ権限属性について説明します。

| 名前                     | Description                                                                                                                                                                                                                                                                                                               |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 名前                     | レコードのわかりやすい名前。 このフィールドは必須です。                                                                                                                                                                                                                                                               |
| エンティティ名              | セキュリティで保護されるエンティティの論理名、または子アクセス許可の関連エンティティをセキュリティで保護するための連絡先リレーションシップまたは親リレーションシップを定義するエンティティの論理名。 このフィールドは必須です。                                                                                                                        |
| スコープ (必須)                   | <ul><li>**グローバル**: 所有者 (contact) の要件を指定せずに、エンティティレコードに特権を付与します。</li><li>**連絡先**: 所有者 (contact) との直接的な関係を持つエンティティレコードに特権を付与します。</li><li>**アカウント**: アカウントに関連付けられているエンティティレコードに権限を付与します。これは、そのアカウントが連絡先の親顧客であることを前提として所有者として機能します。</li><li>**親**: 親アクセス許可のリレーションシップのチェーンを通じて、エンティティレコードに特権を付与します。</li></ul>|
| 連絡先の関係     | スコープが Contact の場合にのみ必要です。 連絡先と、[エンティティ名] フィールドで指定したエンティティとのリレーションシップのスキーマ名。|
| 親リレーションシップ      | 親エンティティ権限が割り当てられている場合にのみ必要です。 "エンティティ名" フィールドによって指定されたエンティティと、その親エンティティのアクセス許可レコードの "エンティティ名" フィールドによって指定されたエンティティ間のリレーションシップのスキーマ名。                                                                                     |
| 親エンティティの権限 | スコープが親の場合にのみ必要です。                                                                                                                                                                                                                                                            |
| 込ん                     | ユーザーがレコードを読み取ることができるかどうかを制御する特権。                                                                                                                                                                                                                                                               |
| 企画                    | ユーザーがレコードを更新できるかどうかを制御する特権。                                                                                                                                                                                                                                                             |
| 生成                   | ユーザーが新しいレコードを作成できるかどうかを制御する特権。 エンティティ型のレコードを作成する権限は、個々のレコードには適用されず、エンティティのクラスにも適用されません。                                                                                                                             |
| デリート                   | ユーザーがレコードを削除できるかどうかを制御する特権。                                                                                                                                                                                                                                                             |
| 追記                   | 指定されたレコードにユーザーが別のレコードを添付できるかどうかを制御する特権。[追加] と [アクセス権の追加] は、組み合わせて使用できます。 ユーザーは、1つのレコードを別のレコードにアタッチするたびに、両方の権限を持っている必要があります。 たとえば、あるケースにメモを添付する場合、操作が機能するようにするには、メモに "追加アクセス" 権限と、追加先のアクセス権を持っている必要があります。  |
| 追加先                | ユーザーが対象のレコードを別のレコードに追加できるかどうかを制御する特権。[追加] と [アクセス権の追加] は、組み合わせて使用できます。 詳細については、追加の説明を参照してください。|
| | |

## <a name="global-permissions-for-tasks-related-to-leads"></a>潜在顧客に関連するタスクのグローバルアクセス許可

1つのシナリオでは、エンティティリストとエンティティフォームを使用して、ポータル上のすべての潜在顧客をカスタム潜在顧客マネージャー web ロールのすべてのユーザーに表示することができます。 リストで潜在顧客の行が選択されるたびに起動される [潜在顧客の編集] フォームでは、関連するタスクレコードがサブグリッドに表示されます。 これらのレコードは、潜在顧客マネージャーロールのすべてのユーザーがアクセスできるようにする必要があります。 最初の手順として、潜在顧客マネージャーロールの全員にリードするグローバルアクセス許可を付与します。

このロールには、グローバルスコープの潜在顧客エンティティに対する関連エンティティアクセス許可があります。

このロールのユーザーは、ポータル上のエンティティリストまたはフォームを使用して、すべての潜在顧客にアクセスできます。

![潜在顧客にグローバルアクセス許可を付与する](../media/grant-global-permission-leads.png "潜在顧客にグローバルアクセス許可を付与する")  

次に、グローバル潜在顧客のアクセス許可に子アクセス許可を追加します。 親のアクセス許可のレコードを開いた状態で、**子エンティティのアクセス許可**のサブグリッドにアクセスし、 **[新規]** を選択してエンティティのアクセス許可の参照を開き、虫眼鏡を選択し、 **[新規作成]** を選択して新しいレコードを追加します。

![Web ロールへのエンティティアクセス許可の追加](../media/add-entity-permission-web-role.png "Web ロールへのエンティティアクセス許可の追加")  

エンティティをタスクとして選択し、スコープを [保護者] として選択します。 その後、親リレーションシップ (**潜在顧客\_のタスク**) を選択できることに注意してください。 この権限は、親権限を持つ web ロールの連絡先が、潜在顧客に関連するすべてのタスクに対するグローバルアクセス許可を持つことを意味します。

リストでこれらのアクセス許可を尊重するには、リストに対してエンティティのアクセス許可を有効にしておく必要があります。また、アクセス許可が付与されているアクションの実行をユーザーに許可するアクションが必要です。 さらに、[エンティティフォーム](entity-forms.md)レコードでもアクセス許可が有効になっている必要があります。また、このフォームは、子アクセス許可を持つ有効にするエンティティ (この場合はタスク) のサブグリッドを持つページを表示する必要があります。 さらに、タスクの読み取りアクセス許可または作成アクセス許可を有効にするには、これらのエンティティフォームも構成する必要があります。また、フォームを編集して、関連ルックアップフィールドを削除する必要があります。  

![Web ページフォームの編集](../media/edit-webpage-form.png "Web ページフォームの編集")  

これにより、潜在顧客に関連するすべてのタスクにアクセス許可が付与されます。 タスクがエンティティリストに表示されている場合は、そのリストにフィルターが基本的に追加されるので、潜在顧客に関連するタスクだけが一覧に表示されます。 この例では、エンティティフォームでサブグリッドを使用して表示されています。

![タスクの例](../media/tasks-example.png "タスクの例")  

## <a name="contact-scoped-permissions-for-tasks"></a>タスクの連絡先スコープのアクセス許可

別の例として、連絡先がそのタスクの親の潜在顧客に関連付けられているタスクへのアクセスを許可する場合があります。 このシナリオは前のセクションとほぼ同じですが、この場合は、親アクセス許可はグローバルではなく、連絡先のスコープを持ちます。 潜在顧客エンティティと Contact エンティティの間の親リレーションシップにリレーションシップを指定する必要があります。

これらのアクセス許可が設定されると、潜在顧客の管理者ロールのユーザーは、連絡先スコープのアクセス許可によって指定されたとおりに直接関連する潜在顧客にアクセスしたり、子のアクセス許可レコードで指定された同じ潜在顧客に関連するタスクにアクセスしたりすることができます。

### <a name="see-also"></a>関連項目

[ポータルの web ロールを作成する](create-web-roles.md)  
[ポータルの web ページへのアクセスを制御する](webpage-access-control.md)