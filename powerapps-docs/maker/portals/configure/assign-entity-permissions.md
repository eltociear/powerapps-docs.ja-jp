---
title: ポータル上のエンティティ アクセス許可を使用しレコード ベースのセキュリティを追加 | MicrosoftDocs
description: エンティティ アクセス許可を追加し、Web ロールを割り当てる手順。
author: sbmjais
manager: shujoshi
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 11/04/2019
ms.author: shjais
ms.reviewer: ''
ms.openlocfilehash: c92b664c2c40c6bb6354e2666d583d5c7ed7aead
ms.sourcegitcommit: 861ba8e719fa16899d14e4a628f9087b47206993
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/03/2019
ms.locfileid: "2874435"
---
# <a name="add-record-based-security-by-using-entity-permissions-for-portals"></a>ポータルのエンティティ アクセス許可を使用してレコード ベースのセキュリティを追加する

個々のレコードに適用されるポータルのレコード ベースのセキュリティを適用するには、エンティティのアクセス許可を使用します。 エンティティへのアクセス許可を Web ロールに追加すると、エンティティのアクセス許可を使用して導入されたレコードの所有権/アクセスの権限および概念に、論理的に対応するロールを組織に定義することができます。 特定の取引先担当者は任意の数のロールに属することが可能で、特定のロールは複数のエンティティのアクセス許可を含むことができます。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [ポータルの Web ロールの作成](create-web-roles.md) 

アクセス許可を変更し、ポータル サイトマップへアクセスする URL は、コンテンツ認証を通して与えられますが、サイトの管理者は、エンティティ フォームおよびエンティティ リストで構築されたカスタム Web アプリケーションもセキュリティで保護したいと考えることでしょう。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [エンティティ フォームを定義する](entity-forms.md) と [エンティティ リストを定義する](entity-lists.md)  

これらの機能を保護するため、エンティティのアクセス許可は、任意のエンティティおよび関連付けの定義を通して有効にされるレコード レベルのセキュリティに対してより詳細な権限が与えられるようになります。

## <a name="add-entity-permissions-to-a-web-role"></a>エンティティのアクセス許可を Web ロールへ追加する

1.  [ポータル管理アプリ](configure-portal.md)を開きます。

2. **ポータル** &gt; **Web ロール** に移動してアクセス許可を追加する Web ロールを開きます。 

3. **関連**で、**エンティティのアクセス許可**を選択します。

4. **既存のエンティティのアクセス許可**を選択して、Web ロールに既存のエンティティのアクセス許可を追加します。 

4. エンティティのアクセス許可を参照するか、**新しいエンティティのアクセス許可**を選択して、新しいエンティティのアクセス許可レコードを作成します。

    ![エンティティのアクセス許可を Web ロールへ追加する](../media/add-entity-permission-web-role.png "エンティティのアクセス許可を Web ロールへ追加する")  

新しいエンティティのアクセス許可レコードを作成するときは、まずセキュリティで保護するエンティティを決定します。 次に、以下で説明するようにスコープを定義し、&mdash;グローバル以外のすべてのスコープの場合は&mdash; そのスコープを定義する関連付けを定義します。 最後に、このアクセス許可によりロールに付与される権限を決定します。 権限は累積的であることに留意してください。あるユーザーに読み取り権限のロールが与えられていて、また読み取りと更新の権限のロールも与えられている場合、そのユーザーは 2 つのロールが重複するすべてのレコードに対して読み取りと更新の権限が与えられます。

> [!Note]
> Web ページや Web ファイルなどの CMS エンティティを選択することは無効であり、意図しない結果が生じる可能性があります。 ポータルは、エンティティのアクセス許可ではなく、コンテンツ アクセス コントロールに基づいて CMS エンティティのセキュリティを挿入します。

### <a name="global-scope"></a>グローバル スコープ

グローバルなスコープが設定されているロールに読み取りアクセス許可が付与されているエンティティ アクセス許可レコードの場合、そのロール内のすべての取引担当者は定義されたエンティティのすべてのレコードに対してアクセスすることができます。 たとえば、彼らはすべての潜在顧客、すべての取引先企業などを表示することができます。 このアクセス許可は、すべてのエンティティ リストに自動的に反映され、特にそのリストで定義されたモデル駆動型アプリのビューに対してすべてのレコードを表示します。 さらに、ユーザーがアクセスする権限がないエンティティ フォームを介してレコードにアクセスを試みると、アクセス許可エラーが発生します。

### <a name="contact-scope"></a>取引先担当者のスコープ

取引先担当者のスコープによって、アクセス許可レコードが拒否されたロールにサインインしたユーザーには、定義された関連付けを介するそのユーザーの取引先担当者レコードに関連するレコードにのみアクセスする許可が与えられます。

エンティティの一覧では、現在のユーザーに直接リンクされるレコードのみを取得するリストによって表示されるどのモデル駆動型アプリ ビューにも、フィルターが追加されていることを意味します。 (シナリオによっては、この関連付けを所有権または管理権限と考えることができます)。

エンティティ フォームは、読み込み、作成、書き込みなどの適切なアクセス許可のみを、レコードがロードされたときにこの関連付けが存在する場合にのみ許可します。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [エンティティ フォームの定義](entity-forms.md).  

### <a name="account-scope"></a>取引先企業のスコープ

取引先企業のスコープによって、アクセス許可レコードが拒否されたロールにサインインしたユーザーには、定義された関連付けを介するそのユーザーの取引先企業の親会社のレコードに関連するレコードにのみアクセスする許可が与えられます。

### <a name="self-scope"></a>自己スコープ

自己スコープにより、ユーザーの独自の取引先担当者 (ID) レコードに対する権限を定義することができます。 これによりユーザーはエンティティ フォームまたは Web フォームを使用して、プロファイルにリンクされた独自の取引先担当者レコードに変更を加えることができます。 既定のプロファイルページには特別な組み込みフォームがあり、すべてのユーザーは基本的な取引先担当者情報の変更、およびマーケティング リストのオプトインまたはオプトアウトなどが可能であることに注意してください。 このフォームがポータルに含まれている (既定では含まれる) 場合は、ユーザーがこれを使用するためのアクセス許可は不要です。 ただし、すべてのユーザー定義エンティティ フォームまたはユーザーのユーザー取引先担当者レコードを対象とする Web フォームを使用するためにこのアクセス許可が必要です。

### <a name="parental-scope"></a>上位下位のスコープ

この最も複雑なサポート案件では、エンティティ アクセス許可レコードが既に定義されたエンティティに当てはまらない関連付けに、アクセス許可が付与されました。 このアクセス許可は、実際は親のエンティティ アクセス許可の子レコードです。

親のアクセス許可レコードはアクセス許可およびエンティティ (グローバルまたは取引先担当者スコープ、親も可能) のスコープを定義します。 そのエンティティは取引先担当者 (取引先担当者スコープの場合) と関連するかまたはグローバルに定義されています。 アクセス許可が用意されると、他のエンティティと親の関連付けで定義されたエンティティとの関連付けを定義する、子のアクセス許可が作成されます。

したがって、親のエンティティのアクセス許可により定義されたレコードにアクセス可能な Web ロールを持つユーザーは、子のアクセス許可レコードにより定義される、親のレコードに関連するレコードへの権限も持ちます。

### <a name="attributes-and-relationships"></a>属性と関連付け

下の表は、エンティティのアクセス許可の属性を説明したものです。

| Name                     | 内容                                                                                                                                                                                                                                                                                                               |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Name                     | レコードの内容を示す名前です。 これは必須フィールドです。                                                                                                                                                                                                                                                               |
| エンティティ名              | セキュリティで保護するエンティティの論理名、または取引先担当者の関連付けを定義する論理名、または子のアクセス許可に関連するエンティティをセキュリティで保護するための親の関連付けの論理名です。 これは必須フィールドです。                                                                                                                        |
| スコープ (必須)                   | <ul><li>**グローバル**: 所有者 (連絡先) の要件なしに、エンティティ レコードに権限を与えます。</li><li>**連絡先**: オーナー (連絡先) と直接関係のあるエンティティ レコードに権限を与えます。</li><li>**アカウント**: アカウントが連絡先の親の顧客であると仮定して、所有者として機能するアカウントとの関係を持つエンティティ レコードに権限を与えます。</li><li>**親**: 親のアクセス許可リレーションシップの連鎖を通じて、エンティティ レコードに特権を与えます。</li></ul>|
| 取引先担当者の関連付け     | スコープが取引先担当者である場合にだけ必要です。 エンティティ名フィールドで指定された取引先担当者とエンティティ間の関連付けのスキーマ名です。|
| 親の関連付け      | 親のエンティティのアクセス許可が割り当てられている場合にのみ必要です。 エンティティ名フィールドで指定されたエンティティと、親エンティティのアクセス許可レコードのエンティティ名フィールドで指定されたエンティティ間の関連付けのスキーマ名です。                                                                                     |
| 親エンティティのアクセス許可 | スコープが親である場合にのみ必要です。                                                                                                                                                                                                                                                            |
| 読み込み                     | ユーザーがレコードを読み取ることができるかどうかをコントロールする特権です。                                                                                                                                                                                                                                                               |
| 書き込み                    | ユーザーがレコードを更新することができるかどうかをコントロールする特権です。                                                                                                                                                                                                                                                             |
| 作成                   | ユーザーが新しいレコードを作成できるかどうかをコントロールする特権です。 エンティティの種類に対するレコードを作成するための権限は個々のレコードには適用されませんが、代わりにエンティティのクラスに適用されます。                                                                                                                             |
| Del                   | ユーザーがレコードを削除できるかどうかをコントロールする特権です。                                                                                                                                                                                                                                                             |
| 追加                   | ユーザーが指定のレコードに別のレコードを追加できるかどうかを制御する特権です。追加とアクセス許可の追加は連携して機能します。 ユーザーは、レコードを別のレコードに添付するときは、毎回両方の権限を所有している必要があります。 たとえば、案件にメモを添付する場合は、メモに対する追加アクセス権と、操作対象の案件に対する追加先アクセス権が必要です。  |
| 追加先                | ユーザーが該当のレコードを別のレコードに追加できるかどうかを制御する特権です。追加とアクセス許可の追加は連携して機能します。 詳細については、追加の説明を参照してください。|
| | |

## <a name="global-permissions-for-tasks-related-to-leads"></a>潜在顧客に関連付けられているタスクに対するグローバル アクセス許可

1 つのシナリオでは、エンティティ リストとエンティティ フォームを使用して、ポータル上のすべての潜在顧客をカスタムの潜在顧客の管理者 Web ロールで誰にでも見せることができます。 リストで潜在顧客の行が選択されるたびに起動される潜在顧客の編集フォームには、サブグリッドに関連するタスク レコードが表示されます。 これらのレコードは潜在顧客マネージャー ロールを持つすべてのユーザーがアクセスすることができます。 最初のステップとしては、潜在顧客マネージャー ロールを持つすべてのユーザーに対して、グローバル アクセス許可を与えます。

このロールにはグローバルなスコープと共に、潜在顧客エンティティに対する、関連するエンティティ アクセス許可があります。

このロールのユーザーは、エンティティ リストまたはポータルのフォームを介してすべてのに潜在顧客にアクセスすることができます。

![潜在顧客にグローバル アクセス許可を付与する](../media/grant-global-permission-leads.png "潜在顧客にグローバル アクセス許可を付与する")  

グローバル潜在顧客のアクセス許可に、子のアクセス許可を追加します。 親アクセス許可レコードを開き、**子エンティティのアクセス許可**サブグリッドへ進み、**新規**を選択してエンティティのアクセス許可のルックアップを開き、 虫眼鏡を選び、**新規**を選択して新しいレコードを追加します。

![エンティティのアクセス許可を Web ロールへ追加する](../media/add-entity-permission-web-role.png "エンティティのアクセス許可を Web ロールへ追加する")  

タスクとしてエンティティ、上位下位としてスコープを選択します。 次に親の関連付け (**Lead\_Tasks**) が選択できることに留意してください。 このアクセス許可は、親のアクセス許可を持つ Web ロール内の取引先担当者が、次に 潜在顧客に関連するすべてのタスクに対して グローバル アクセス許可を持つことを意味します。

これらのアクセス許可にリストを関連付けるためには、リストのエンティティ アクセス許可を有効にし、またアクセス許可が付与されたことを示すアクションをユーザーが実行することを実際に許可するアクションが必要です。 さらに、アクセス許可は [エンティティ フォーム](entity-forms.md) レコードでも有効化される必要があります。またそのフォームは子のアクセス許可、この場合はタスクを有効にするエンティティに対するサブグリッドを持つページを表示する必要があります。 さらに、タスクに対して読み取りまたは作成アクセス許可を有効にするには、それらのエンティティ フォームも構成する必要があり、このフォームから関連する検索フィールドを削除するためにフォームを編集する必要があります。  

![Web ページのフォームを編集する](../media/edit-webpage-form.png "Web ページのフォームを編集する")  

これにより、次に潜在顧客に関連するすべてのタスクのアクセス許可が与えられます。 タスクがエンティティ リストに表示される場合は、基本的にフィルターがリストに追加され、潜在顧客に関連するタスクのみがリストに表示されるようになります。 この例では、それらはエンティティ フォームのサブグリッドに表示されています。

![タスクの例](../media/tasks-example.png "タスクの例")  

## <a name="contact-scoped-permissions-for-tasks"></a>取引先担当者対象のタスクへのアクセス許可

もう一つの例は、そのタスクに対する親の潜在顧客が関連する取引先担当者に対するタスクへのアクセスを許可する場合です。 このシナリオは前のセクションとほぼ同じですが、このサポート案件では親のアクセス許可が、グローバルの代わりに取引先担当者のスコープを持つことが異なります。 関連付けは、潜在顧客エンティティと取引先担当者エンティティの間に、親の関連付けを指定する必要があります。

これらのアクセス許可が設定された後、潜在顧客マネージャー ロールを持つユーザーは、取引先担当者スコープ アクセス許可により指定された関連する潜在顧客に直接アクセスすることができます。また子のアクセス許可レコードにより指定された同じ潜在顧客に関連するタスクにもアクセスすることができます。

### <a name="see-also"></a>関連項目

[ポータルの Web ロールの作成](create-web-roles.md)  
[ポータル用 Web ページへのアクセスの制御](webpage-access-control.md)