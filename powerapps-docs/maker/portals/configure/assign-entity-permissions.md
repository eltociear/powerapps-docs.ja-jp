---
title: ポータル上のエンティティ アクセス許可を使用しレコード ベースのセキュリティを追加 | MicrosoftDocs
description: エンティティ アクセス許可を追加し、Web ロールを割り当てる手順。
author: sandhangitmsft
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 11/04/2019
ms.author: sandhan
ms.reviewer: tapanm
ms.openlocfilehash: decf82358731cabeda2a27599cab16e3a579cbba
ms.sourcegitcommit: c12260f372ad2cc48d3146be570d2088c9ef1d86
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/20/2020
ms.locfileid: "3491452"
---
# <a name="add-record-based-security-by-using-entity-permissions-for-portals"></a>ポータルのエンティティ アクセス許可を使用してレコード ベースのセキュリティを追加する

個々のレコードに適用されるポータルのレコード ベースのセキュリティを適用するには、エンティティのアクセス許可を使用します。 エンティティへのアクセス許可を Web ロールに追加すると、エンティティのアクセス許可を使用して導入されたレコードの所有権/アクセスの権限および概念に、論理的に対応するロールを組織に定義することができます。 特定の取引先担当者は任意の数のロールに属することが可能で、特定のロールは複数のエンティティのアクセス許可を含むことができます。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [ポータルの Web ロールの作成](create-web-roles.md) 

アクセス許可を変更し、ポータル サイトマップへアクセスする URL は、コンテンツ認証を通して与えられますが、サイトの管理者は、エンティティ フォームおよびエンティティ リストで構築されたカスタム Web アプリケーションもセキュリティで保護したいと考えることでしょう。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [エンティティ フォームを定義する](entity-forms.md) と [エンティティ リストを定義する](entity-lists.md)  

これらの機能を保護するため、エンティティのアクセス許可は、任意のエンティティおよび関連付けの定義を通して有効にされるレコード レベルのセキュリティに対してより詳細な権限が与えられるようになります。

## <a name="add-entity-permissions-to-a-web-role"></a>エンティティのアクセス許可を Web ロールへ追加する

1.  [ポータル管理アプリ](configure-portal.md)を開きます。

2. **ポータル** &gt; **Web ロール** に移動してアクセス許可を追加する Web ロールを開きます。 

3. **関連**で、**エンティティのアクセス許可**を選択します。

4. **既存のエンティティのアクセス許可**を選択して、Web ロールに既存のエンティティのアクセス許可を追加します。 

4. エンティティのアクセス許可を参照するか、**新しいエンティティのアクセス許可**を選択して、新しいエンティティのアクセス許可レコードを作成します。

    ![エンティティのアクセス許可を Web ロールへ追加する](../media/add-entity-permission-web-role.png "エンティティのアクセス許可を Web ロールへ追加する")  

新しいエンティティのアクセス許可レコードを作成するときは、まずセキュリティで保護するエンティティを決定します。 次に、以下で説明するようにスコープを定義し、&mdash;グローバル以外のすべてのスコープの場合は&mdash; そのスコープを定義する関連付けを定義します。 最後に、このアクセス許可によりロールに付与される権限を決定します。 なお、権限は累積的に機能するため、ユーザーが、読み取りを許可しているロールと、読み取りと更新を許可している別のロールに属している場合、そのユーザーには、2 つのロールの間で重複するすべてのレコードに対する読み取りと更新の権限が付与されます。

> [!Note]
> Web ページや Web ファイルなどの CMS エンティティを選択することは無効です。これらを選択すると、意図しない結果を招く可能性があります。 ポータルでは、エンティティのアクセス許可ではなく、コンテンツ アクセス コントロールに基づいて CMS エンティティのセキュリティがアサートされます。

### <a name="global-scope"></a>グローバル スコープ

読み取りアクセス許可のあるエンティティ アクセス許可レコードがグローバル スコープのロールに付与された場合、そのロールのすべての取引先担当者は、定義されたエンティティのすべてのレコードにアクセスできるようになります。 たとえば、すべてのリードやすべての勘定などを表示できるようになります。 このアクセス許可は、すべてのエンティティ リストに自動的に反映され、特にそのリストで定義されたモデル駆動型アプリのビューに対してすべてのレコードを表示します。 さらに、ユーザーがアクセスする権限がないエンティティ フォームを介してレコードにアクセスを試みると、アクセス許可エラーが発生します。

### <a name="contact-scope"></a>取引先担当者のスコープ

取引先担当者のスコープによって、アクセス許可レコードが拒否されたロールにサインインしたユーザーには、定義された関連付けを介するそのユーザーの取引先担当者レコードに関連するレコードにのみアクセスする許可が与えられます。

エンティティの一覧では、現在のユーザーに直接リンクされるレコードのみを取得するリストによって表示されるどのモデル駆動型アプリ ビューにも、フィルターが追加されていることを意味します。 (シナリオによっては、このリレーションシップは所有権または管理権限と考えることができます)。

エンティティ フォームは、読み込み、作成、書き込みなどの適切なアクセス許可のみを、レコードがロードされたときにこの関連付けが存在する場合にのみ許可します。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [エンティティ フォームの定義](entity-forms.md).  

### <a name="account-scope"></a>取引先企業のスコープ

取引先企業のスコープによって、アクセス許可レコードが拒否されたロールにサインインしたユーザーには、定義された関連付けを介するそのユーザーの取引先企業の親会社のレコードに関連するレコードにのみアクセスする許可が与えられます。

### <a name="self-scope"></a>自己スコープ

自己スコープにより、ユーザーの独自の取引先担当者 (ID) レコードに対する権限を定義することができます。 これにより、ユーザーはエンティティ フォームまたは Web フォームを使用して自分の連絡先レコードを変更することができます。 既定のプロファイル ページには、すべてのユーザーが基本的な連絡先情報を変更したり、マーケティング リストからオプトインやオプトアウトできるようにするための特別な組み込みフォームが用意されています。 このフォームがポータルに含まれている場合 (既定では含まれています)、ユーザーはこのアクセス許可がなくてもそのフォームを使用できます。 ただし、ユーザー取引先担当者レコードを対象とするユーザー定義エンティティ フォームや Web フォームを使用する場合は、このアクセス許可が必要です。

### <a name="parental-scope"></a>親スコープ

この最も複雑なケースでは、エンティティ アクセス許可レコードが既に定義されているエンティティと直接のリレーションシップを持たないエンティティについて、アクセス許可が付与されます。 このアクセス許可は、実際には、親エンティティのアクセス許可の子レコードです。

親アクセス許可レコードでは、特定のエンティティに対するアクセス許可とスコープが定義されます (多くの場合は、グローバルまたは取引先担当者のスコープです。ただし、親スコープも可能です)。 そのエンティティは、取引先担当者 (取引先担当者スコープの場合) に関連付けられている場合と、グローバルに定義されている場合があります。 このアクセス許可が設定されている場合は、親のリレーションシップで定義されたエンティティともう 1 つのエンティティとのリレーションシップを定義する、子アクセス許可が作成されます。

そのため、親エンティティのアクセス許可で定義されたレコードにアクセスできる Web ロールのユーザーは、子のアクセス許可レコードで定義された内容に従って、親レコードに関連付けられたレコードへの権限も付与されます。

### <a name="attributes-and-relationships"></a>属性とリレーションシップ

次の表は、エンティティ アクセス許可の属性について説明したものです。

| Name                     | 内容                                                                                                                                                                                                                                                                                                               |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 名前                     | レコードの内容を示す名前。 これは必須フィールドです。                                                                                                                                                                                                                                                               |
| エンティティ名              | セキュリティで保護するエンティティの論理名、または取引先担当者の関連付けを定義する論理名、または子のアクセス許可に関連するエンティティをセキュリティで保護するための親の関連付けの論理名です。 これは必須フィールドです。                                                                                                                        |
| スコープ (必須)                   | <ul><li>**グローバル**: 所有者 (連絡先) の要件なしに、エンティティ レコードに権限を与えます。</li><li>**連絡先**: オーナー (連絡先) と直接関係のあるエンティティ レコードに権限を与えます。</li><li>**アカウント**: アカウントが連絡先の親の顧客であると仮定して、所有者として機能するアカウントとの関係を持つエンティティ レコードに権限を与えます。</li><li>**親**: 親のアクセス許可リレーションシップの連鎖を通じて、エンティティ レコードに特権を与えます。</li></ul>|
| 取引先担当者の関連付け     | スコープが取引先担当者である場合にのみ必要です。 取引先担当者と、[エンティティ名] フィールドで指定されたエンティティの間のリレーションシップのスキーマ名。|
| 親の関連付け      | 親エンティティのアクセス許可が割り当てられている場合にのみ必要です。 エンティティ名フィールドで指定されたエンティティと、親エンティティのアクセス許可レコードのエンティティ名フィールドで指定されたエンティティ間の関連付けのスキーマ名です。                                                                                     |
| 親エンティティのアクセス許可 | スコープが親である場合にのみ必要です。                                                                                                                                                                                                                                                            |
| 読み取り                     | ユーザーがレコードを読み取ることができるかどうかを制御する特権。                                                                                                                                                                                                                                                               |
| 書き込み                    | ユーザーがレコードを更新できるかどうかを制御する特権。                                                                                                                                                                                                                                                             |
| 作成                   | ユーザーが新しいレコードを作成できるかどうかを制御する特権。 エンティティの種類に対するレコードを作成するための権限は個々のレコードには適用されませんが、代わりにエンティティのクラスに適用されます。                                                                                                                             |
| 削除                   | ユーザーがレコードを削除できるかどうかを制御する特権。                                                                                                                                                                                                                                                             |
| 追加                   | ユーザーが指定のレコードに別のレコードを追加できるかどうかを制御する権限。"追加" と "追加先" アクセス権は、連携して機能します。 レコードを別のレコードに関連付けるには、そのユーザーがこれら両方の権限を持っている必要があります。 たとえば、ケースにメモを関連付ける場合は、メモに対する "追加" アクセス権と、その操作対象のケースに対する "追加先" アクセス権が必要です。  |
| 追加先                | ユーザーが対象のレコードを別のレコードに追加できるかどうかを制御する特権。"追加" と "追加先" アクセス権は、連携して機能します。 詳細については、"追加" の説明を参照してください。|
| | |

## <a name="global-permissions-for-tasks-related-to-leads"></a>リードに関連するタスクのグローバル アクセス許可

ここでは、エンティティ リストとエンティティ フォームを使用して、ポータル上のすべてのリードを、カスタムのリード マネージャー Web ロールのユーザーに公開したい場合について考えてみましょう。 リード編集フォーム (リストでリードの行が選択されたときに起動されます) では、関連するタスク レコードがサブグリッドに表示されます。 これらのレコードに、リード マネージャー ロールのすべてのユーザーがアクセスできるようにする必要があるとします。 その場合、最初のステップとしてリード マネージャー ロールのすべてのユーザーに対して、グローバル アクセス許可を付与します。

このロールには、リード エンティティの関連エンティティ アクセス許可 (グローバル スコープ) があります。

このロールのユーザーは、エンティティ リストまたはポータルのフォームを介してすべてのに潜在顧客にアクセスすることができます。

![潜在顧客にグローバル アクセス許可を付与する](../media/grant-global-permission-leads.png "潜在顧客にグローバル アクセス許可を付与する")  

グローバル潜在顧客のアクセス許可に、子のアクセス許可を追加します。 親アクセス許可レコードを開き、**子エンティティのアクセス許可**サブグリッドへ進み、**新規**を選択してエンティティのアクセス許可のルックアップを開き、 虫眼鏡を選び、**新規**を選択して新しいレコードを追加します。

![エンティティのアクセス許可を Web ロールへ追加する](../media/add-entity-permission-web-role.png "エンティティのアクセス許可を Web ロールへ追加する")  

エンティティとして "タスク" を、スコープとして "上位下位" を選択します。 次に親の関連付け (**Lead\_Tasks**) が選択できることに留意してください。 このアクセス許可は、親のアクセス許可を持つ Web ロール内の取引先担当者が、次に 潜在顧客に関連するすべてのタスクに対して グローバル アクセス許可を持つことを意味します。

ご使用のリストにこれらのアクセス許可を適用するには、そのリストに対して [エンティティのアクセス許可] を有効にしておく必要があります。また、ユーザーにアクセス許可が付与されているアクションを、実際に実行できるようにするアクションが存在している必要があります。 さらに、アクセス許可は [エンティティ フォーム](entity-forms.md) レコードでも有効化される必要があります。またそのフォームは子のアクセス許可、この場合はタスクを有効にするエンティティに対するサブグリッドを持つページを表示する必要があります。 さらに、タスクの読み取りまたは作成のアクセス許可を有効にするには、それらのエンティティ フォームも構成し、各フォームを編集して、[関連] 検索フィールドを削除する必要があります。  

![Web ページのフォームを編集する](../media/edit-webpage-form.png "Web ページのフォームを編集する")  

これにより、リードに関連するすべてのタスクに対するアクセス許可が付与されます。 タスクがエンティティ リストに表示されている場合は、リストにフィルターが追加され、リードに関連するタスクのみがリストに表示されます。 この例では、エンティティ フォーム上のサブグリッドにそれらが表示されます。

![タスクの例](../media/tasks-example.png "タスクの例")  

## <a name="contact-scoped-permissions-for-tasks"></a>タスクに対する取引先担当者スコープのアクセス許可

もう 1 つの例として、タスクへのアクセスを許可する際、取引先担当者がそのタスクの親リードに関連付けられている場合について考えてみましょう。 このシナリオは前のセクションとほぼ同じですが、親アクセス許可のスコープがグローバルではなく、取引先担当者であるという点が違います。 リレーションシップは、リード エンティティと取引先担当者エンティティの間の親リレーションシップで指定する必要があります。

これらのアクセス許可が設定された後、潜在顧客マネージャー ロールを持つユーザーは、取引先担当者スコープ アクセス許可により指定された関連する潜在顧客に直接アクセスすることができます。また子のアクセス許可レコードにより指定された同じ潜在顧客に関連するタスクにもアクセスすることができます。

### <a name="see-also"></a>関連項目

[ポータルの Web ロールの作成](create-web-roles.md)  
[ポータル用 Web ページへのアクセスの制御](webpage-access-control.md)