---
title: ID プロバイダーを Azure AD B2C に移行する | MicrosoftDocs
description: ID プロバイダーを Azure AD B2C に移行する方法について説明します。
author: tapanm-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 10/18/2019
ms.author: tapanm
ms.reviewer: ''
ms.openlocfilehash: 30051019d90bc042ceb50ef486fb184da39a8892
ms.sourcegitcommit: a0d069f63d2ce9496d578f81e65cd32bec2faa4d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/23/2020
ms.locfileid: "2980134"
---
# <a name="migrate-identity-providers-to-azure-ad-b2c"></a>ID プロバイダーを Azure AD B2C に移行する

ポータルは、顧客が複数の認証システムをサポートすることができるセキュリティ システムの構成をサポートします。 ポータルには、OIDC、SAML、および WS-Federation などの標準プロトコルを使用する外部 ID プロバイダーとの連合に加え、独自のローカルの資格情報が含まれます。 いずれは、認証に Azure AD B2C ID プロバイダーのみを使用して、他の ID プロバイダーを使用しなくなることを推奨していました。 

## <a name="marking-an-identity-provider-as-deprecate"></a>ID プロバイダーを廃止としてマークする

他の ID プロバイダーを廃止済みとしてマークし、ユーザーが Azure AD B2C ID プロバイダーに移行することができるようにポータルを構成することができます。 

以下のサイト設定は ID プロバイダーの廃止をコントロールするために使用します。

| Name  | 内容  |
|--------|--------|
| Authentication/Registration/LocalLoginDeprecated | true または false の値。 true にセットされる場合、ローカル アカウントは廃止済みとしてマークされます。 ポータル ユーザーは廃止されていないアカウントに移行するよう要求されます。 既定では false に設定されています。 |
| Authentication/[protocol]/[provider]/Deprecated  | true または false の値。 true にセットされる場合、特定のアカウントは廃止済みとしてマークされます。 ポータル ユーザーは廃止されていないアカウントに移行するよう要求されます。 既定では false に設定されています。 |
|||

ポータル ユーザーがサインインを試み、少なくとも 1 つの ID プロバイダーを廃止としてマーク済みのとき、廃止されたアカウントがページ上に表示されます。 以下の例では、Microsoft アカウントは廃止済みとしてマークされます。

![非推奨アカウントの例](../media/gdpr-deprecate-account.png "非推奨アカウントの例")

従来の認証プロバイダーの画面上のテキストは、次のコンテンツ スニペットを使用して変更することができます。

| Name                                               | 種類​​ | Value                         |
|----------------------------------------------------|------|-------------------------------|
| Account/Signin/SignInExternalDeprecatedFormHeading | テキスト | 従来のアカウントでサインインする |
|||

> [!NOTE]
> 廃止された ID プロバイダーは、ポータルの招待状を登録または引き換えるときに表示されません。

## <a name="migrating-a-deprecated-identity-provider-to-a-new-identity-provider"></a>廃止済み ID プロバイダーを新しい ID プロバイダーに移行する

ポータル ユーザーが廃止済みの ID プロバイダーにサインインする場合、アカウント移行画面に、削除されていない ID プロバイダーでサインインするようにメッセージが表示されます。 ユーザーが削除されていない ID プロバイダーでサインインすると、ユーザー アカウントは新しいプロバイダに関連付けられます。

![アカウント移行の例](../media/gdpr-account-migration.png "アカウント移行の例")

アカウント移行の画面上のメッセージは、次のコンテンツ スニペットを使用して変更することができます。

| Name                                         | 種類​​ | Value                                                                                                                                                                                                                |
|----------------------------------------------|------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Account/Conversion/PageTitle                 | テキスト | アカウントの移行                                                                                                                                                                                                    |
| Account/Conversion/PageCopy                  | HTML | サポートされなくなったアカウントでサインインしました。 このポータルの使用を継続するには、別のアカウントに移行する必要があります。 下のボタンを選択して、新しいアカウントまたは既存のサポートされるアカウントでサインインしてください。 |
| Account/Conversion/SignInExternalFormHeading | テキスト | サポートされているアカウントでサインインします。                                                                                                                                                                                     |
|||

ポータルでは複数の ID を単一の取引先担当者レコードに関連付けることができます。 複数のプロバイダーが廃止されると、ポータル ユーザーは使用条件に複数回同意する必要があります。 ユーザーが廃止された ID プロバイダーでサインインするときはいつでも、廃止された各プロバイダーのためにアカウント移行プロセスが起動し、アカウント移行後に取引先企業レコードは廃止されていないプロバイダーに関連付けられます。

例: ポータルは Microsoft アカウント (MSA)、Google、および Facebook を認証の ID プロバイダーとしてサポートします。 Google および Facebook を廃止済みプロバイダーとしてマークし、ポータル ユーザーが認証の ID プロバイダーとして Google および Facebook のみを所有する場合、そのユーザーがこれら 2 つのプロバイダーのいずれかを使用してサインインを試みるとアカウント移行メッセージが表示されます。 ユーザーが MSA を使用してサインインすると、MSA はユーザーの取引先担当者レコードに追加されます。 ユーザーはサポートされている認証 ID プロバイダーとして MSA のみを持つようになりました。

ポータル ユーザーが新しい ID プロバイダーを選択して、ID がすでに別の取引先担当者レコードに関連付けられているとき、エラー メッセージが表示されます。 次のコンテンツ スニペットを使用してエラー メッセージを構成することができます。

| Name                                                     | 種類​​ | Value                                                                                                                               |
|----------------------------------------------------------|------|-------------------------------------------------------------------------------------------------------------------------------------|
| Account/Signin/AccountConversionIdentityUsedErrorHeading | テキスト | アカウント変換エラー                                                                                                            |
| Account/Signin/AccountConversionIdentityUsedErrorText    | HTML | このアカウントは既に存在します。 ブラウザーを閉じてプロセスを再起動し、[アカウントの移行] ページで異なるアカウントを選択してください。 |
|||

## <a name="disabling-local-login"></a>ローカル ログインの無効化

`Authentication/Registration/LocalLoginDeprecated` サイト設定を使用して、ローカル ログインを無効にするようにポータルを構成することができます。 誰かがローカル資格情報を使用してサインインを試みる場合、アカウント移行画面が、削除されていない ID プロバイダーでサインインするための手順とともに表示されます。 アカウントが移行されると、ユーザーのローカル資格情報は無効になります。

> [!NOTE]
> ローカル ログインを廃止済みとマークする場合、新しいアカウントに登録することはできなくなります。

ユーザーに対してローカル ログインが無効にされたかを示す、以下のフィールドがポータルの取引先担当者レコードに追加されます。
- **ローカル ログインが無効**: 取引先担当者がローカル アカウントを使用してポータルにサインインできなくなることを示します。 既定では、**いいえ**に設定されています。 ユーザーのアカウントが削除されていない ID プロバイダーに移行されてローカル ログインが無効にされた場合、このフィールドは**はい**に設定されます。

    ![ローカル ログインが無効](../media/local-login-disabled.png "ローカル ログインが無効")
