---
title: エンティティフォームを定義する |MicrosoftDocs
description: ポータルでエンティティフォームを作成する方法について説明します。
author: sbmjais
manager: shujoshi
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 11/04/2019
ms.author: shjais
ms.reviewer: ''
ms.openlocfilehash: 79e6f02f9a13f1c828efe5c472d267e707b09576
ms.sourcegitcommit: d9cecdd5a35279d78aa1b6c9fc642e36a4e4612c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/04/2019
ms.locfileid: "73552706"
---
# <a name="about-entity-forms"></a>エンティティフォームについて

エンドユーザーがポータルでフォームを追加するためのフォームを追加できるデータドリブン構成。開発者がポータルにフォームを配置する必要はありません。エンティティフォームは Common Data service で作成され、ポータルの web ページに配置されるか、または w で使用されます。完成した web アプリケーションを構築するためのサブグリッドとエンティティリストを作成しました。 [エンティティリストに関する](entity-lists.md)[!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] 

![お問い合わせフォーム](../media/contact-us-form.png "お問い合わせフォーム")  

## <a name="add-a-form-to-your-portal"></a>フォームをポータルに追加する

エンティティフォームには、web ページへのリレーションシップと、ポータル内のフォームの初期化を制御する追加のプロパティが含まれています。 Web ページへの関係により、web サイト内の特定のページノードのフォーム定義を動的に取得できます。 

既存のエンティティフォームを表示したり、新しいエンティティフォームを作成したりするには、[ポータル管理アプリ](configure-portal.md)**を開き、ポータル &gt;** **エンティティフォーム**にアクセスします。

新しいエンティティフォームを作成する場合は、最初の手順として、表示する**エンティティ**と**フォームの名前**と、**モード (Insert、Edit、または Read Only**) を決定します。 選択したモードによって、ポータルから新しいレコードを作成するか、既存のレコードを編集するか、またはポータル上のレコードに関する情報を表示するかが決まります。

> [!Note]
> - フォームがサイト内で表示されるようにするには、特定の web サイトの web ページに**エンティティフォーム**が関連付けられている必要があります。
> - エンティティ形式では、接続エンティティサブグリッドはサポートされていません。 フォームデザイナーを使用して接続エンティティサブグリッドをフォームに追加すると、ポータルでフォームを表示し、接続エンティティを使用すると、エラーメッセージが表示されます。
> - エンティティフォームでは、重複フィールド、複数選択オプションセット、カスタムコントロール、およびビジネスルールはサポートされていません。
> - ビジネスルールとクライアント API は、読み取り専用のフォームでロックされたフィールドを有効にすることができます。
> - 挿入モードでエンティティフォームを作成した場合、ボタンの配置を変更したり、エンティティフォームの上にアクションボタンを配置したりすることはできません。
> - フォーム上のドロップダウンリストとして参照コントロールを表示すると、関連レコードフィルターが機能しません。

エンティティフォームに関連付けられている Web ページを表示するには、左端のメニューにある**関連する**ナビゲーションリンクに一覧表示されている **[Web ページ]** リンクを選択します。

Web ページを作成または編集するときに、Web ページフォームに表示されるルックアップフィールドに**エンティティフォーム**を指定できます。

ポータルで使用されるさまざまなマスターページには、 **Entityform**サーバーコントロールの宣言が含まれています。 ページ (~/Pages/Page.aspx) ページテンプレートまたは Full Page (~/Pages/FullPage.aspx) ページテンプレートのいずれかを含む web ページを表示する場合、コントロールは、エンティティフォームの参照に値が含まれているかどうかを判断します。この場合、フォームは表示されます。

## <a name="secure-your-forms"></a>フォームをセキュリティで保護する

フォームをセキュリティで保護するには、web ロールに従ってレコードのアクセスと所有権を決定するエンティティ権限を作成する必要があります。 ユーザーがエンティティフォームにアクセスし、アクセス許可がない場合は、エラーメッセージが表示されます。 エンティティフォームに対するアクセス許可を有効にするには、[**エンティティのアクセス許可を有効**にする] を [true] に設定します。 [ポータルの web ロールを作成](create-web-roles.md)[!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] ます。  

## <a name="entity-form-attributes-and-relationships"></a>エンティティフォームの属性とリレーションシップ

|名前|Description|
|-----|----------|
|名前|レコードのわかりやすい名前。 このフィールドは必須です。|
|エンティティ名|フォームの読み込み元となるエンティティの名前。 このフィールドは必須です。|
|フォーム名| 表示するターゲットエンティティ上のフォームの名前。 このフィールドは必須です。|
|タブ名|  表示される、指定されたエンティティのフォーム上のタブの名前 (省略可能)。|
|モード|次のいずれかの値です。<ul><li>Insert</li><li>編集</li><li>ReadOnly</li></ul>[_挿入_] を選択すると、送信時にフォームが新しいレコードを挿入する必要があることを示します。 _Edit_を指定すると、フォームが既存のレコードを編集する必要があることを示します。 [ _ReadOnly_ ] を選択すると、既存のレコードの編集不可フォームがフォームに表示されることを示します。 _編集_と_読み取り専用_を行うには、ソースレコードが存在し、[レコードソースの種類] と [レコード ID クエリ文字列パラメーターの名前] フィールドで指定されたパラメーターが、フォームがポータルに読み込まれるときに適切なレコードを選択する必要があります。|
|レコードソースの種類|次のいずれかの値です。<ul><li>クエリ文字列</li><li>現在のポータルユーザー</li><li>現在のポータルユーザーに関連付けられているレコード</li></ul>_クエリ文字列_を選択するには、URL のクエリ文字列で形式のパラメーター名を指定する必要があります。 これは、[レコード ID クエリ文字列パラメーター名] フィールドで指定できます。<br>_現在のポータルユーザー_を選択すると、現在の認証済みユーザーのポータルユーザーレコードが取得されます。<br>_現在のポータルユーザーに関連付けられているレコード_を選択すると、現在の認証済みユーザーのポータルユーザーレコードが取得され、[リレーションシップ名] フィールドで指定された特定のリレーションシップのレコードが取得されます。|
|レコード ID クエリ文字列パラメーター名| このエンティティフォームを含む Web ページの URL のクエリ文字列に指定されたパラメーター名。|
|リレーションシップ名| レコードソースの種類が現在のポータルユーザーに関連付けられているレコードの場合に必要です。 現在のポータルユーザーレコードとターゲットレコードとのリレーションシップの論理名。 これは、[エンティティ名] フィールドで指定したのと同じエンティティ型を返す必要があります。|
|Null の場合に作成を許可|  レコードソースの種類が現在のポータルユーザーに関連付けられているレコードの場合に使用できる、省略可能なブール値です。 関連するレコードが存在しない場合に、ユーザーが初めて作成できるようにすることを示します。それ以外の場合、フォームがデータバインドのためのレコードを必要とするため、レコードが存在しない場合は例外がスローされます。|
|エンティティのアクセス許可を有効にする| により、フォームはエンティティのアクセス許可を尊重します。 旧バージョンとの互換性のため、既定値は false です。 True に設定すると、フォームにアクセスするすべてのユーザーに対して明示的なアクセス許可が必要になります。|
|||

### <a name="form-options"></a>フォームのオプション

|名前|Description|
|----|---------|
|Captcha の追加|   Captcha を表示します。|
|認証されたユーザーの Captcha を表示する|  認証されたユーザーの captcha を表示します。|
|検証グループ|  名前付きグループの有効な入力を評価するために入力コントロールに割り当てられたグループ名。|
|タブからステップを自動生成する| 1つのエンティティフォームに複数のタブが表示されることを示します。各タブは、最初のタブから順に順番に実行され、すべてのタブが移動され、最終的な送信時にレコードが挿入されるまで続きます。 既定では選択されていません。 既定値は、現在のステップに対して1つのタブまたはフォームのみが表示されることを示します。 タブ名が指定されていない場合は、最初のタブが表示されます。|
|Web リソースをインラインでレンダリングする|   エンティティフォーム内の web リソースを含む iframe を除去します。|
|ツールヒントの有効化|  ツールヒントは、ターゲットエンティティの属性の説明を使用して設定されます。|
|サポートされていないフィールドの表示|   現在、すべてのフィールドがサポートされています。 これは、フィールド型に対して発生する可能性のある変更 Common Data Service ために予約されています。|
|推奨フィールドを必須として設定する|    フィールド要件レベルが "Business 推奨" に設定されているすべての属性が必要になります。|
|すべてのフィールドを必須にする|  フィールド要件レベルに関係なく、すべてのフィールドが必要になります。|
|検証の概要 CSS クラス|  検証の概要に割り当てられた CSS クラス名。 既定値は ' 検証-概要アラートアラート-エラーアラート-ブロック '|
|検証の概要リンクを有効にする|   エラーが格納されているフィールドまでスクロールするために、アンカーリンクを検証の概要でレンダリングする必要があるかどうかを示すブール値 true または false。 既定値は true です。|
|検証の概要リンクテキスト|  検証概要リンクに割り当てられたラベル。 既定値は [ここをクリック] です。|
|検証の概要ヘッダーのテキスト|    検証概要ヘッダーに割り当てられたラベル。|
|マニュアル|  フォームを操作するための手順です。|
|レコードが見つかりませんメッセージ|  レコードが見つからないときに表示されるメッセージ。|
|||

### <a name="on-success-settings"></a>成功時の設定

|名前|Description|
|----|----------|
|成功時|    次のいずれかの値です。<ul><li>成功メッセージを表示する (既定)</li><li>読み込み</li></ul>|
|成功時にフォームを非表示にする|  成功メッセージを表示するには、Success が設定されている必要があります。 この選択を行うと、フォームの送信が成功したときにフォームが非表示になります。|
|成功メッセージ|   成功メッセージを表示するには、Success が設定されている必要があります。 送信が成功したときにユーザーに表示されるメッセージ。 指定されていない場合、既定のメッセージ (送信が正常に完了しました) が表示されます。 組織に対してインストールされて有効になっている言語パックごとに、関連付けられた言語でメッセージを入力するためのフィールドを使用できるようになります。|
|外部 URL|成功時にリダイレクトに設定する必要があります。 Web 上の外部リソースへの URL を指定します。
|または Web ページ|成功時にリダイレクトに設定する必要があります。 現在の web サイトから Web ページを選択します。|
|既存のクエリ文字列の追加|  成功時にリダイレクトに設定する必要があります。 選択すると、リダイレクトの前に既存のクエリ文字列パラメーターがターゲット URL に追加されます。|
|クエリ文字列にレコード ID を追加する|  成功時にリダイレクトに設定する必要があります。 この値を選択すると、作成されるレコードの ID が、リダイレクト先の URL のクエリ文字列に追加されます。|
|レコード ID クエリ文字列パラメーター名|     成功時にリダイレクトに設定する必要があります。 リダイレクト先の URL のクエリ文字列内の ID パラメーターの名前。|
|カスタムクエリ文字列の追加|    成功時にリダイレクトに設定する必要があります。 リダイレクト URL の既存のクエリ文字列に追加できるカスタム文字列。|
|クエリ文字列に属性値を追加する-パラメーター名|   成功時にリダイレクトに設定する必要があります。 リダイレクト URL のクエリ文字列に追加されるターゲットエンティティの属性値に関連付けられるパラメーターに指定する名前。|
|クエリ文字列に属性値を追加する-属性の論理名|成功時にリダイレクトに設定する必要があります。 リダイレクト URL のクエリ文字列に追加される値を取得する対象エンティティの属性の論理名。|
|||

### <a name="additional-settings"></a>追加設定

|名前|Description|
|----|----------|
|現在のポータルユーザーを関連付ける| 現在ログインしているユーザーのレコードが、ターゲットエンティティレコードに関連付けられていることを示します。|
|ターゲットエンティティポータルのユーザー参照属性|    ポータルユーザーを格納するターゲットエンティティの属性の論理名。|
|アクティビティのパーティ| ターゲットエンティティポータルのユーザー参照属性がアクティビティのパーティタイプであるかどうかを示すブール値。|
|ファイルの添付|   フォームの下部にファイルアップロードコントロールが含まれていることを確認し、ファイルをレコードに添付できるようにします。|
|File Storage の場所のアタッチ|  オプション: メモ添付ファイル、Azure Blob Storage。 Azure Storage を使用するように組織が構成されている場合は、このエンティティ形式のファイルを保存するかどうかを選択できます。 それ以外の場合、を含むファイルはメモの添付ファイルとして格納されます。|
|複数のファイルを許可する|ユーザーが複数のファイルをアップロードできるかどうかを示すブール値。|
|受入|    Accept 属性は、ファイルのアップロードを通じてサーバーが受け入れるファイルの MIME の種類を指定します。 複数の値を指定するには、値をコンマで区切ります (例: audio/ *、video/* 、image/*)。|
|ラベル| ファイルアップロードコントロールの横に表示されるテキスト。 組織に対してインストールされて有効になっている言語パックごとに、関連付けられた言語でメッセージを入力するためのフィールドを使用できるようになります。|
|添付ファイルが必要です| 続行するために必要なファイルの添付ファイルを作成します。|
|必須のエラーメッセージ|が必要な場合は、フォームの検証中に表示されるメッセージは true であり、ユーザーにはファイルが添付されていません。 組織に対してインストールされて有効になっている言語パックごとに、関連付けられた言語でメッセージを入力するためのフィールドを使用できるようになります。|
|許容される型にファイルを制限する|  Accept フィールドに対して強制的に検証を行います。 この属性を選択しないと、[ファイルのアップロード] ダイアログの候補としてのみ、Accept 属性が使用されます。|
|ファイルの種類のエラーメッセージ|[許可された種類にファイルを制限する] が true で、ユーザーが無効なファイルの種類をアップロードしようとした場合に、フォームの検証中に表示されるメッセージ。 組織に対してインストールされて有効になっている言語パックごとに、関連付けられた言語でメッセージを入力するためのフィールドを使用できるようになります。|
|ファイルの最大サイズ (kb)|  アップロードされたファイルの最大許容サイズを強制的に検証します。|
|ファイルサイズのエラーメッセージ|   [ファイルの最大サイズ (kb 単位)] が true で、ユーザーが大きすぎるファイルをアップロードしようとした場合に、フォームの検証中に表示されるメッセージ。 組織に対してインストールされて有効になっている言語パックごとに、関連付けられた言語でメッセージを入力するためのフィールドを使用できるようになります。|
|カスタム JavaScript| フォームの終了タグ要素の直前にページの下部に追加される JavaScript のカスタムブロック。 エンティティフィールドの HTML 入力 id は、属性の論理名に設定されます。 これにより、jQuery でフィールドの選択、値の設定、またはその他のクライアント側の操作を簡単に行うことができます。<br>`$(document).ready(function() {   $(“#address1_stateorprovince”).val(“Saskatchewan”);});`|
|||

### <a name="entity-reference"></a>エンティティ参照

次のパラメーターは、フォームが保存されるときにエンティティ参照を設定することに関連しています。

これにより、フォームによって作成または更新されている現在のレコードを別のターゲットレコードに関連付けることができます。 これは、複数のエンティティ型を持つ複数の手順があり、結果のレコードを関連付ける必要がある場合や、関連付けたいレコード id のクエリ文字列がページに渡される場合に便利です。 たとえば、ジョブの投稿を一覧にしたキャリアページがあります。このページには、アプリケーションが作成されたときに、そのレコードに関連付けられているジョブの id を含むジョブのアプリケーションへのリンクが表示されます。 

|名前|Description|
|-----|---------|
|保存時にエンティティ参照を設定する|イエスかノーか答えてください。 値が yes の場合は、フォームを保存するときにエンティティ参照を割り当てる必要があることを示します。それ以外の場合は、何も設定されません。|
|リレーションシップ名|2つのエンティティ型間の特定のリレーションシップのリレーションシップ定義名。|
|エンティティの論理名|参照エンティティの論理名。|
|ターゲット参照属性の論理名|作成または更新するターゲットエンティティの参照属性の論理名。|
|参照フィールドの設定| 参照エンティティに関する参照がフォーム上にある場合、この値を確認すると、フォームのフィールドに、次の設定を使用して取得した値が設定されます。|
|参照エンティティのソースの種類|  次のいずれかの値です。<ul><li>クエリ文字列</li><li>現在のポータルユーザー</li><li>前のステップからの結果</li></ul> _クエリ文字列_を選択するには、URL のクエリ文字列で形式のパラメーター名を指定する必要があります。 これは、 **[クエリ文字列名]** フィールドで指定できます。 このパラメーターが主キーの場合は、**クエリ文字列が主キー**の場合は はい を選択します。それ以外の場合は いいえ を選択し、**クエリ属性の論理名** フィールドで指定したクエリ対象のエンティティの属性の論理名を指定します。  現在のポータルユーザーを選択すると、現在の認証済みユーザーの連絡先レコードが取得されます。 前の手順の結果を選択すると、現在のステップの前のステップの結果として作成されたレコード、またはエンティティソースのステップに関連付けられているステップに基づいて特定のステップから作成されたレコードが取得されます。|
|参照エンティティステップ| このステップで作成または編集されたエンティティを取得し、この現在のステップのレコードに関連付けるエンティティを取得する前の手順の Web フォームステップレコード。|
|クエリ文字列名| Web フォームを含む Web ページの URL のクエリ文字列に指定されたパラメーター名。|
|クエリ文字列は主キーです|   [はい] は、クエリ文字列の値が主キーの値であることを示します。 No は、クエリ文字列値が主キー以外の属性の型であることを示します。|
|クエリ属性の論理名|  レコードを照会する属性の論理名。|
|読み取り専用の詳細の表示| 参照レコードに関する読み取り専用の情報を表示するページの上部にフォームを表示する必要があることを示します。 フォーム名が必要です。|
|フォーム名| 読み取り専用の詳細を表示するために使用する必要がある、参照エンティティ上のフォームの名前。|
|||


## <a name="entity-form-action-configuration"></a>エンティティフォームアクションの構成

既定では、エンティティフォームは、既存のレコードの読み取りまたは更新、または新しいレコードの挿入を許可します。  ただし、エンティティフォーム内のレコードに対する追加のアクション (削除、アクティブ化、非アクティブ化など) を簡単に有効にして構成することもできます。 また、アクションが有効になっている場合に表示される既定のラベル、サイズ、およびその他の属性を上書きすることもできます。

これらの設定は、エンティティフォームの **[追加設定]** セクションにあります。 既定では、**基本設定**のみが表示されます。 **[詳細設定]** を選択すると、追加の設定を表示できます。

個々のレコードに適用可能なアクションのアクションボタンを追加して、[エンティティのアクセス許可](assign-entity-permissions.md)によって適切な特権が付与されている場合は、グリッドの各行に表示されるようにすることができます。 次の操作を実行できます。

- デリート
- 稟議
- 関連レコードの作成
- する
- 非

これらのオプションのいずれかをクリックすると、その操作の構成領域が表示されます。 さらに、特定のエンティティには、エンティティごとに使用できる特別なアクションがあります。

- 営業案件の値を計算する (営業案件)
- キャンセルの Case アクション (インシデント)
- ケースアクションを閉じる (解決する) (インシデント)
- 見積もりを順序に変換 (引用符)
- 注文を請求書に変換 (salesorder)
- 営業案件から見積もりを生成する (営業案件)
- 営業案件の操作の損失 (営業案件)
- Win 営業案件のアクション (営業案件)
- ケースアクションを再度開く (インシデント)
- 保留中の営業案件の設定 (営業案件)

> [!NOTE]
> ビジネスプロセスに必要な特定の**状態**と**状態コード**の値が定義されている既定のエンティティに対して、 **[アクティブ化]** または **[非アクティブ]** 化 ボタンを追加するのではなく、ワークフローを作成することをお勧めします。 たとえば、インシデント ([状態のオプション](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/incident#statuscode-options))、営業案件 ([状態のオプション](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/opportunity#statuscode-options))、権利 (状態の[オプション](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/entitlement#statuscode-options)) などです。 


## <a name="geolocation-configuration-for-entity-forms"></a>エンティティフォームの位置情報の構成

マップコントロールを表示して、マップ上のピンとして既存の場所を表示したり、ユーザーが場所を指定できるようにしたりするために、管理されたフォームを構成することができます。 「[位置](add-geolocation.md)情報の追加」を参照してください。

フォームのマップコントロールでは、さまざまな場所フィールドの Id を指定したり、値を割り当てたり、値を取得したりするために、追加の構成が必要になります。 エンティティフォームレコードには、指定する必要があるこれらのフィールドマッピングを定義する構成セクションがあります。 フィールド名は、作成したスキーマによって異なります。

![エンティティ形式の位置情報データ](../media/geolocation-managed-form.png "エンティティ形式の位置情報データ") 

> [!Note]
> - 位置情報が有効になっている場合、読み取り専用エンティティ形式の address フィールドがマップに置き換えられます。
> - 位置情報セクションは、ドイツ語のソブリンクラウド環境では表示されません。 ユーザーが別のフォームを使用して位置情報を有効にしている場合は、ポータルでの表示時に表示されません。

### <a name="see-also"></a>関連項目

[ポータルの構成](configure-portal.md)  
[ポータルの Web フォームのプロパティ](web-form-properties.md)  
[ポータルの Web フォームの手順](web-form-steps.md)  
[ポータルの Web フォームメタデータ](configure-web-form-metadata.md)  
[ポータルの Web フォームサブグリッドの構成](configure-web-form-subgrid.md)  
[ポータルのエンティティフォームと Web フォームのメモ構成](../configure-notes.md)
