---
title: Common Data Service における日時フィールドの動作と形式 | MicrosoftDocs
ms.custom: ''
ms.date: 05/25/2018
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
author: Mattp123
ms.assetid: 73d691c7-344e-4c96-8979-c661c290bf81
caps.latest.revision: 47
ms.author: matp
manager: kvivek
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 67e172bfcb0a9e1b8cc344892f15e74d070d28fe
ms.sourcegitcommit: c6906775005aec98973b1f5c3dbe5924aff6d26e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2020
ms.locfileid: "3341484"
---
# <a name="behavior-and-format-of-the-date-and-time-field"></a>日時フィールドの動作と形式

Common Data Service では、日付と時刻のデータ型は標準エンティティの多くのフィールドで使用されます。 フィールドが表す日付の種類に応じて、**ユーザー ローカル**、**日付のみ**、または**タイム ゾーン非依存**という異なるフィールドの動作を選択できます。  
  
<a name="Behavior"></a>   

## <a name="date-and-time-field-behavior-and-format"></a>日時フィールドの動作と形式  

次の表には、[日付と時刻]フィールドの動作と形式に関する説明が含まれています。  
  
|動作|書式|説明|  
|--------------|------------|-------------------------------|  
|**ユーザー ローカル** |**日付のみ**<br />- または -<br />**日付と時間**|これは、ユーザー定義の日付フィールドの既定の動作です。<br /><br />フィールドの値は、ユーザーの現在の現地時間で表示されます。<br />Web サービスでは、これらの値は、共通の UTC タイム ゾーン形式を使用して返されます。<br /><br />既定の動作を選択した場合、これを 1 回だけ変更することができます。 詳細 [ユーザー ローカル動作の変更](#change-user-local-behavior)|  
|**日付のみ**|**日付のみ**|タイム ゾーン変換はありません。<br /><br />値の時刻の部分は、常に午前 12:00 です。<br />値の日付の部分は、UI と Web サービスで指定されている通りに保存および取得されます。|  
|**タイム ゾーン非依存**|**日付のみ**<br />- または -<br />**日付と時間**|タイム ゾーン変換はありません。<br /><br />日付と時刻の値は、UI と Web サービスで指定されている通りに保存および取得されます。|  

## <a name="change-user-local-behavior"></a>ユーザー ローカル動作の変更:

マネージド ソリューションの発行者がこれを禁止しない限り、既存のカスタム日付フィールドの動作を**ユーザー ローカル**から**日付のみ**、または**タイムゾーン非依存**へ変更することができます。 これは一度のみの変更です。

フィールドの動作を変更すると、フィールドの動作の変更後に追加または変更されるフィールド値に影響があります。 既存のフィールド値は、データベース内では、UTC タイム ゾーン形式のままです。 既存のフィールド値の動作を UTC から [日付のみ] に変更するには、それをプログラムで実行するために開発者の助けが必要な場合があります。 詳細: [データベース内の既存の日時の値の動作を変更する](/dynamics365/customer-engagement/developer/behavior-format-date-time-attribute#convert-behavior-of-existing-date-and-time-values-in-the-database). 

> [!WARNING]
> 既定の日時フィールドの動作を変更するには、その前に、業務ルール、ワークフロー、計算フィールド、またはロールアップ フィールドなどのフィールドのすべての依存関係を検討して、動作の変更によって問題が発生しないことを確認する必要があります。 日時フィールドの動作を変更した後、変更したフィールドに依存する、ビジネス ルール、ワークフロー、計算フィールド、ロールアップ フィールドのそれぞれを開いて、情報をレビューし、その情報を保存して、最後の日付フィールドの動作と値が使用されることを確認する必要があります。 

### <a name="change-behavior-during-a-solution-import"></a>ソリューションのインポート中に動作を変更する

**ユーザー ローカル**動作を使用して日付フィールドを含むソリューションをインポートする場合は、動作を**日付のみ**または**タイムゾーン非依存**に変更することもできます。  

### <a name="prevent-changing-behavior"></a>動作の変更を防ぐ

マネージド ソリューションの既存の日付フィールドを配布する場合は、**CanChangeDateTimeBehavior** 管理プロパティを **False** に設定し、ソリューションを使用するユーザーが動作を変更しないようにすることができます。 詳細: [フィールドの管理型プロパティの設定](set-managed-properties-for-field.md)
  
## <a name="use-cases"></a>使用例 

次の**日付のみ**および**タイム ゾーン非依存**動作の使用例について考えてみましょう。

### <a name="date-only-scenario-birthdays-and-anniversaries"></a>日付のみの例: 誕生日と記念日

[日付のみ] 動作は、誕生日や記念日など時刻とタイムゾーンに関する情報が必要とされない場合に適しています。 この選択の場合、 世界のすべてのアプリ ユーザーに、まったく同じ日付の値が表示されます。  
  
### <a name="time-zone-independent-scenario-hotel-check-in"></a>タイム ゾーン非依存の例: ホテルのチェックイン

ホテルのチェックイン時間など、タイム ゾーン情報が必要でないときにこの動作を使用できます。 これを選択した場合、全世界のすべてのアプリ ユーザーに、同じ日時の値が表示されます。  


## <a name="best-practices-for-using-time-zone"></a>タイムゾーンを使用するためのベスト プラクティス

### <a name="for-my-datetime-field-i-was-expecting-utclocal-and-i-am-seeing-the-opposite-value"></a>期待していた自分の日付/時刻フィールド (UTC/ローカル) で、反対の値が表示されています

これは、エンティティフィールドの設定とアプリフォームの設定の間にパリティがないために発生します。 エンティティ フィールドが [タイムゾーン非依存] または [ユーザーローカル] に構成されている場合、データがストアから取得されるときに、タイムゾーンのオフセットが適用されるかどうかが決まります。 ただし、アプリ フォームには UTC またはローカルの設定もあります。 
 
これは Common Data Service から受け取ったデータを解釈する方法をフォームに伝えます。 ストアから取得したデータがタイムゾーンに依存しないが、フォームがローカルに設定されている場合、UTC データはユーザーのタイムゾーンに基づいてユーザーのローカルタイムとしてプロファイルに表示されます。 この逆も当てはまります。フォームが UTC に設定されている場合、ストアからのユーザーローカル値は UTC として表示されます。 幸い、フォームの日付タイムゾーン値は、既存のレコードを中断することなく変更できます。

### <a name="i-picked-date-only-in-my-entity-field-but-my-form-is-showing-a-time-picker-along-with-the-date"></a>エンティティ フィールドで [日付のみ] を選択しましたが、フォームには日付ピッカーが表示されています。

これは、日付のみのフィールドに対してタイムゾーン非依存またはユーザー ローカルの動作を選択した場合に発生します。 Common Data Service の中に、規定では 00:00:00 の時刻が保存されますが、フィールドをフォームに追加する場合は時刻も設定する必要があると想定します。 フォームに時間ピッカーを残した場合、ユーザーは時間を入力でき 00:00:00 以外として保存されます。 どうすれば修正できますか
* フォームを編集して、時間ピッカーと関連する数式を削除します。 これにより、時刻が 00:00:00 として保存され、タイムゾーン ベースの日付計算が可能になります。
* 現在、フィールドはユーザー ローカルに設定されており、日付をタイムゾーンで計算する必要がない場合は、日付のみに変更できます。 この変更は永続的であり、元に戻すことができません。 この変更は、タイムゾーンに依存しない動作フィールドに対して行うことはできません。 他のアプリ、プラグイン、ワークフローがデータに依存している可能性があるため、動作の変更には常に注意してください。

### <a name="i-have-a-date-only-field-but-it-is-showing-the-wrong-date-for-some-users"></a>日付のみのフィールドがありますが、一部のユーザーに間違った日付が表示されています
これが発生した場合は、日付のみのフィールドに設定されている動作を確認してください。 フィールドがタイムゾーン非依存またはユーザーローカルに設定されている場合、含まれるタイム スタンプにより、日付がユーザーごとに異なって表示されます。 UTC やローカルのフォーム表示設定により、表示される日付がユーザーのタイムゾーン設定を使用して計算されるのか、それとも UTC 値として表示されるのかが決まります。 フォームの値をユーザー ローカルではなく UTC に変更すると、タイムゾーン オフセットの計算ができなくなり、保存されたレコードの UTC での日付が表示されます。 または、これを変更しない静的な日付にする必要があり、フィールドが現在ユーザー ローカルである場合は、フィールド動作を日付のみに変更できます。 ただし、これを元に戻すことはできません。

### <a name="my-scriptplug-in-is-supposed-to-intercept-the-date-submitted-using-the-universal-client-before-the-user-local-conversion-occurs-but-instead-it-is-being-treated-as-user-local-data"></a>私 (スクリプト/プラグイン) は、ユーザー ローカル変換が発生する前に、ユニバーサル クライアントを使用して送信された日付をインターセプトする必要がありますが、代わりにユーザー ローカル データとして扱われます 

UTC とユーザー ローカルの間でデータが変換される場合、Web クライアントとユニバーサル クライアントの動作は少し異なります。 Web クライアントでは、日付がクライアントに入力され、提供されたとおりに API に渡され、後でユーザーのローカル時間に変換されます。 これにより、スクリプト/プラグインがデータを取得し、データがプラットフォーム サービスに渡されてユーザーのローカル時間に変換される前にアクションを実行できるようになりました。 ユニバーサル クライアントでは、データが API に渡される前に日付からユーザーローカル値への変換が行われます。これにより、提供されるデータは UTC 日付ではなく、取得または投稿したユーザーに基づいてユーザー ローカルになります。 これを解決するには、ユーザーは次のいずれかを実行できます。

* フォームを UTC 値を保持するタイムゾーン非依存に変更します。 これは、ユーザーがユーザー ローカル時間でフォームを表示する必要がない場合にのみ機能します。
* スクリプトを変更して、使用されているタイムゾーン オフセットを検出し、スクリプト内で UTC に再計算して、アクションを実行します。

## <a name="date-and-time-query-operators-not-supported-for-date-only-behavior"></a>[日付のみ] の動作でサポートされない日付および時刻のクエリ演算子  

次の日付および時刻関連のクエリ演算子は、**日付のみ**に対しては無効です。 これらの演算子の 1 つが使用されると、無効な演算子の例外エラーがスローされます。  
  
- が X 分よりも古い  
- が X 時間よりも古い  
- 過去 X 時間  
- 今後 X 時間  

  
### <a name="see-also"></a>関連項目

[フィールドの作成および編集](create-edit-fields.md)<br />
[計算フィールドを定義して手動計算を自動化する](define-calculated-fields.md)<br />
[フィールド管理プロパティ](set-managed-properties-metadata.md#view-and-edit-field-managed-properties)<br />
[マネージド プロパティ](/power-platform/alm/managed-properties-alm)  
[ブログ: Common Data Service のタイムゾーンの操作](https://powerapps.microsoft.com/en-us/blog/working-with-time-zones-in-the-common-data-service/)


