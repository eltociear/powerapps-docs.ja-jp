---
title: Power Apps でセグメント化されたソリューションを使用する | MicrosoftDocs
description: ソリューションのセグメント化を使用してソリューションを更新する方法の学習
ms.custom: ''
ms.date: 02/04/2020
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
author: Mattp123
ms.assetid: 5c05f683-e1bd-4885-be23-b6973128773f
caps.latest.revision: 15
ms.author: matp
manager: kvivek
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: d13eafa6858a6eec86de2db08504575c7fab9acd
ms.sourcegitcommit: 60a721432b3fa2abd14ccb3bd16a6b34e13ada85
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/05/2020
ms.locfileid: "3026374"
---
# <a name="use-segmented-solutions"></a>セグメント化されたソリューションの使用 

ソリューションおよびソリューションの修正プログラムで配布する内容をより厳格にコントロールするには、ソリューションのセグメント化を使用します。 アプリの複雑さに応じて、ソリューションのセグメント化は、1 つのソリューションをコンポーネント タイプ (あるソリューションのエンティティ、2 つ目のソリューションのキャンバス アプリ、3 つ目のソリューションのプラグインなど) ごとにセグメント化するあらゆる操作と同じくらい簡単です。 セグメント化したソリューションを作成するには、コードを書かないで、Power Apps でソリューション領域を使用できます。  

ソリューションをセグメント化するには、主に 3 つの方法があります。 
- アプリを構築するときにソリューションをセグメント化します。 これを行うには、特定のコンポーネントを追加して、ソリューションの対象を制御します。 詳細: [エンティティ資産を使用してセグメント化したソリューションを作成](#create-a-segmented-solution-with-entity-assets)
- セグメント化されたソリューションを作成して、ソリューションのマイナー アップデートをビルドおよびリリースします。 これを行うには、修正プログラムをクローンします。 詳細: [ソリューション修正プログラムの作成](#create-a-solution-patch)
- セグメント化されたソリューションを作成して、ソリューションのメジャー アップデートをビルドおよびリリースします。 これを行うには、ソリューションをクローンします。 詳細: [ソリューションの複製](#clone-a-solution)

## <a name="when-to-plan-for-segmentation"></a>セグメント化を計画するタイミング 
アプリに入るデータをどのようにモデル化するかの計画と同様に、ソリューションを配布する前にセグメント化の計画を検討する必要があります。 最初のアプリが構築されてから 1 〜 2 年後に、単一のソリューションから複数のソリューションにソリューションをセグメント化することは複雑で、問題を引き起こす傾向があります。  

## <a name="solutions-as-patches"></a>修正プログラムとしてのソリューション
ソリューションのセグメント化では、すべての資産を含むエンティティ全体ではなく、選択したエンティティ資産 (エンティティ フィールド、フォーム、ビューなど) をソリューション修正プログラムと共にエクスポートできます。 

ソリューション内の内容のコントロールの強化に加えて、修正プログラムの記述の内容もコントロールできます。 上位のソリューションの修正プログラムを作成して、それをマイナー更新プログラムとして基本ソリューションにエクスポートできます。 ソリューションを複製するときは、システムは基本ソリューションに関連するすべての修正プログラムをロールバックして、新しいバージョンを作成します。  
  
 修正プログラムおよび複製されたソリューションを使用するとき、以下の点に注意してください。  
  
-   修正プログラムは、上位のソリューションへの逐次のマイナーな更新プログラムを表しています。 修正プログラムは、ターゲット システムへのインストール時に、コンポーネントおよび資産を上位のソリューション内で追加または更新できますが、上位ソリューションからコンポーネントまたは資産を削除することはできません。  
  
-   修正プログラムは 1 つの上位のソリューションにしか対応できませんが、上位のソリューションは 1 つ以上の修正プログラムに対応できます。  
  
-   修正プログラムはアンマネージド ソリューションに対して作成されます。 管理ソリューションに対して修正プログラムを作成することはできません。  
  
-   ターゲット システムに修正プログラムをエクスポートするときは、マネージド修正プログラムとしてエクスポートする必要があります。 運用環境では、アンマネージド修正プログラムを使用しないでください。  
  
-   修正プログラムをインストールするには、ターゲット システムに上位のソリューションが存在している必要があります。  
  
-   修正プログラムを削除または更新できます。  
  
-   上位のソリューションを削除すると、すべての子の修正プログラムも削除されます。 システムは、削除操作は元に戻すことができませんという警告メッセージを表示します。 削除は単一のトランザクションで実行されます。 修正プログラムの 1 つまたは親のソリューションを削除できなかった場合、トランザクション全体がロールバックされます。  
  
-   上位のソリューションの最初の修正プログラムを作成すると、そのソリューションはロックされ、このソリューションを変更することまたはエクスポートすることはできません。 ただし、その子の修正プログラムをすべて削除すると、上位のソリューションのロックが解除されます。  
  
-   基本ソリューションを複製するとき、すべての子の修正プログラムはその基本ソリューションにロールアップされて、その基本ソリューションが新しいバージョンになります。 複製されたソリューション内のコンポーネントおよび資産を追加、編集、または削除することができます。  
  
-   複製されたソリューションは、ターゲット システムにマネージド ソリューションとしてインストールされたときの基本ソリューションの置き換えを示します。 通常、複製されたソリューションを使用して、前のソリューションの重要な更新プログラムを配布します。  
  
### <a name="understanding-version-numbers-for-cloned-solutions-and-patches"></a>複製されたソリューションおよびと修正プログラムのバージョン番号について  
 ソリューションのバージョンの形式は major.minor.build.revision です。 修正プログラムのビルド番号またはリビジョン番号は、上位のソリューションよりも大きくする必要があります。 それよりも上位のメジャーまたはマイナー バージョンは使用できません。 たとえば、基本ソリューションのバージョンが 3.1.5.7 の場合、修正プログラムはバージョン 3.1.5.8 またはバージョン 3.1.7.0 になることはできますが、バージョン 3.2.0.0 になることはできません。 複製されたソリューションのバージョン番号は、基本ソリューションのバージョン番号以上になる必要があります。 たとえば、基本ソリューションのバージョンが 3.1.5.7 の場合、複製されたソリューションはバージョン 3.2.0.0 またはバージョン 3.1.5.7 になることができます。 UI で設定できるのは、複製ソリューションのメジャーおよびマイナー バージョンの値と、修正プログラムのビルドまたはリビジョンの値のみです。  
  
## <a name="create-a-segmented-solution-with-entity-assets"></a>エンティティ資産を使用してセグメント化したソリューションを作成 
 セグメント化したソリューションを作成するには、アンマネージド ソリューションの作成と既存のリソースの追加から開始します。 複数のシステムやユーザー定義エンティティを追加できます。それらのエンティティごとに、ソリューションに含める資産を選択します。 ウィザード風のセットアップにより、エンティティ資産の追加のプロセスを段階的に進みます。  
  
1. Power Apps ポータルに移動し、**ソリューション** を選択します。  
  
2.  **新規ソリューション** を選択してソリューションを作成します。 必須フィールドに情報を入力します。 **作成**を選びます。  
  
3.  作成したソリューションを開きます。 コマンド バーで、**既存を追加** を選択し、次に **エンティティ** を選択します。  
  
4.  **既存のエンティティを追加する** ペインで、連絡先などの標準エンティティやカスタム エンティティなど、ソリューションに追加する 1 つ以上のエンティティを選択します。 **次へ**を選択します。  
    > [!div class="mx-imgBorder"] 
    > ![既存のエンティティの追加](media/add-existing-entities1.png)

5.  **エンティティを選択** ペインでは、含めるアセットから選択できます。 
    - **すべてのコンポーネントを含める**。 このオプションにはすべてのコンポーネント*かつ*エンティティに関連付けられたメタデータが含まれます。 ビジネス プロセス フロー、レポート、接続、キューなどの他のエンティティまたはエンティティ コンポーネントを含めることができます。 
    - **エンティティ メタデータを含める**。 このオプションにはエンティティに関連付けられたメタデータ*のみ*含まれます。 メタデータには、監査、重複データ検出、変更追跡などのエンティティ属性が含まれます。 
    - **コンポーネントを選択する**。 このオプションを使用すると、フィールド、リレーションシップ、ビジネス ルール、ビュー、フォーム、グラフなど、エンティティに関連付けられている各コンポーネントを個別に選択できます。 
      > [!div class="mx-imgBorder"] 
      > ![エンティティ コンポーネントの選択](media/add-existing-entities2.png)
  
6.  **追加**を選択します。  

### <a name="create-a-segmented-solution-using-solution-explorer"></a>ソリューション エクスプローラーを使用してセグメント化されたソリューションを作成する  
次の図に、エンティティ資産を`Account`エンティティ、`Case`エンティティ、および`Contact`エンティティから選択してセグメント化したソリューションを作成した例を示します。  

> [!NOTE]
> ケース エンティティは、Dynamics 365 Customer Service などの一部の Dynamics 365 アプリケーションに含まれています。 
  
作成したアンマネージド ソリューションを開くことから始めます。 **エンティティ** コンポーネントを選択します。  

 > [!div class="mx-imgBorder"] 
 > ![既存のリソースを追加。](media/solution-segmentation-add-existing-resources-admin.png "既存のリソースを追加。")  
  
 次に、ソリューション コンポーネントを選択します。  
  
 ![ソリューションのコンポーネントを選択。](media/solution-segmentation-select-components-admin.png "ソリューションのコンポーネントを選択。")  
  
 ウィザードに従います。 手順 1 で、アルファベット順に開始して、次のように、最初のエンティティである`Account`エンティティの資産を選択します。  
  
 ![ウィザードを開始します。](media/solution-segmentation-wizard-starts-admin.png "ウィザードを開始します。")  
  
 **フィールド**タブを開き、**取引先企業番号**フィールドを選択します。  
  
 ![取引先企業のエンティティ資産を選択します。](media/solution-segmentation-select-account-assets-admin.png "取引先企業のエンティティ資産を選択します。")  
  
 手順 2 で、**サポート案件**エンティティについて、すべての資産を追加します。  
  
 ![サポート案件のエンティティ資産を選択します。](media/solution-segmentation-select-case-assets-admin.png "サポート案件のエンティティ資産を選択します。")  
  
 手順 3 で、**取引先担当者**エンティティの**記念日**フィールドを追加します。  
  
 ![取引先担当者のエンティティ資産を選択します。](media/solution-segmentation-select-contact-assets-admin.png "取引先担当者のエンティティ資産を選択します。")  
  
 その結果、作成したセグメント化されたソリューションには、`Account`、`Case`、および`Contact`の 3 つのエンティティが含まれます。 各エンティティには選択した資産のみが含まれます。  
  
 > [!div class="mx-imgBorder"] 
 > ![エンティティを含むソリューション。](media/solution-segmentation-solution-entities-admin.png "エンティティを含むソリューション。")  
  
## <a name="create-a-solution-patch"></a>ソリューション修正プログラムの作成  
 修正プログラムには、コンポーネントおよび資産の追加または編集などの、上位のソリューションへの変更が含まれています。 上位のコンポーネントを編集する場合でない限り、上位コンポーネントを含める必要はありません。  
  
### <a name="create-a-patch-for-an-unmanaged-solution"></a>アンマネージド ソリューションに対して修正プログラムを作成する  
  
1. Power Apps ポータルに移動し、**ソリューション** を選択します。   
  
2. ソリューションの一覧で、修正プログラムを作成する対象のアンマネージド ソリューションを選択します。 コマンド バーで、**閉じる**を選択し、次に**修正プログラムの複製**を選択します。 右側のウィンドウに、基本ソリューションの名前と修正プログラムのバージョン番号が含まれています。 **保存**を選択します。  
   > [!div class="mx-imgBorder"] 
   > <img src="media/clone-a-patch.png" alt="Clone a patch" height="735" width="408">
 
3. ソリューションの一覧で、新しく作成された修正プログラムを見つけて開きます。 _修正プログラム_*16 進数*による、ソリューションの一意の名前が追加されていることに注意してください。 基本ソリューションの場合とまったく同様に、必要な資産とコンポーネントを追加します。  
  
#### <a name="create-a-patch-using-solution-explorer"></a>ソリューション エクスプローラーを使用して修正プログラムを作成する
 次の図に、既存のソリューションの修正プログラムを作成する例を示します。 **修正プログラムの複製**を選択して開始します (圧縮されたビューでは、**修正プログラムの複製**アイコンは、次に示すように、2 つの小さい正方形として表示されます)。  
  
 > [!div class="mx-imgBorder"] 
 > ![[修正プログラムの複製] アイコン。](media/solution-segmentation-click-patch-icon-admin.png "[修正プログラムの複製] アイコン。")  
  
 **修正プログラムに対する複製**ダイアログ ボックスで、修正プログラムのバージョン番号は上位のソリューションのバージョン番号が基になっているが、ビルド番号は 1 つずつ増加することが分かります。 後続の各修正プログラムのビルドまたはリビジョン番号は、直前の修正プログラムよりも大きくなっています。  
  
 ![[修正プログラムに対する複製] ダイアログを使用。](media/solution-segmentation-clone-patch-dialog-admin.png "[修正プログラムに対する複製] ダイアログを使用。")  
  
 次のスクリーンショットは、基本ソリューション **SegmentedSolutionExample** のバージョン **1.0.1.0** と、修正プログラム **SegmentedSolutionExample_Patch** のバージョン **1.0.2.0** を示しています。  
  
 > [!div class="mx-imgBorder"] 
 > ![ソリューションおよび修正プログラムを含むグリッド。](media/solution-segmentation-solution-patch-grid-admin.png "ソリューションおよび修正プログラムを含むグリッド。")  
  
 修正プログラムでは、`Book` という名前の新しいユーザ定義エンティティを追加して、`Book` エンティティのすべての資産をその修正プログラムに含めました。  
  
 ![修正プログラム内にユーザー定義エンティティを追加。](media/solution-segmentation-add-book-patch-admin.png "修正プログラム内にユーザー定義エンティティを追加。")  
  
## <a name="clone-a-solution"></a>ソリューションの複製  
 アンマネージド ソリューションを複製すると、元のソリューションとこのソリューションに関連するすべての修正プログラムが元のソリューションの新しく作成したバージョンにロールアップされます。 複製が完了すると、ソリューションの新しいバージョンに元のエンティティに加えて修正プログラムに追加したというすべてのコンポーネントまたはエンティティが格納されています。 

![ソリューションの複製](media/cloned-solution.png)

> [!IMPORTANT]
> ソリューションを複製すると、元のソリューションと関連するパッチが削除されます。 
  
1. Power Apps ポータルに移動し、**ソリューション** を選択します。   
  
2.  ソリューションの一覧で、複製を作成する対象のアンマネージド ソリューションを選択します。 コマンド バーで、**閉じる**を選択し、次に**ソリューションの複製**を選択します。 右側のウィンドウに、基本ソリューションの名前と新しいバージョン番号が表示さています。 **保存**を選択します。  
  
  
### <a name="next-steps"></a>次のステップ  
 [ソリューションの概要](solutions-overview.md)


