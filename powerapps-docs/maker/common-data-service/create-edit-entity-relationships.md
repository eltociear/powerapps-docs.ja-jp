---
title: Common Data Service におけるエンティティの関係性の概要 | MicrosoftDocs
ms.custom: ''
ms.date: 04/25/2019
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- PowerApps
ms.assetid: c765b6d9-4d87-4c2d-aae2-5b1c3b664a71
caps.latest.revision: 28
ms.author: matp
manager: kvivek
author: Mattp123
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 89a28060f7894afe49d0abe36b4461d6e2cbc474
ms.sourcegitcommit: 2b34de88c977c149e4c632b23d8e816901c15949
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/12/2020
ms.locfileid: "3040396"
---
# <a name="entity-relationships-overview"></a>エンティティの関連付けの概要
エンティティ関係は、データベースでレコードがどのように相互に関連しているかを定義します。 最も簡単なレベルでは、エンティティに検索フィールドを追加することにより、2 つのエンティティ間の新しい 1:N (1 対多数) の関連付けが作成され、フォームに検索フィールドを設定できるようにします。 検索フィールドを使用すると、ユーザーはエンティティの複数の*子*レコードを一つの*親*エンティティ レコードに関連付けることができます。  
  
レコードが別のレコードにどのように関連するかを定義することに加え、1:N のエンティティ関係は、以下の問題に対処するデータを提供します。  
  
- レコードを削除すると、そのレコードに関連するレコードも削除されますか。  
- レコードを割り当てると、そのレコードに関連するすべてレコードを新しい所有者に割り当てる必要がありますか。  
- 既存のレコードのコンテキストで新しい関連レコードを作成するとき、データ入力プロセスをどのように合理化できますか。  
- レコードを表示する際、関連レコードをどのように表示できるようにしますか。  
  
 2 つのエンティティの任意の数のレコードが相互に関連している場合、エンティティは N:N (多対多) の関連付けもできます。  

<a name="BKMK_Connections"></a>

## <a name="decide-whether-to-use-entity-relationships-or-connections"></a>エンティティ関係や接続を使用するかどうかを決定 
エンティティ関係はデータベースに変更を加えるメタデータのことです。 これらの関係は、クエリが関連データを効率的に取得できるようにします。 エンティティ関係を使用して、エンティティを定義するまたはほとんどのレコードが使用できる正式の関連付けを定義します。 たとえば、顧客になる可能性のない営業案件はあまり役に立ちません。 営業案件エンティティには、競合企業エンティティとの N:N の関連付けがあります。 これにより、複数の競合企業を営業案件に追加できます。 このデータを取得し、競合企業を表示するレポートを作成することができます。  
  
レコード間のあまり正式でない関連付けは、*つながり*と呼ばれます。 たとえば、2 人の取引先担当者は結婚していること、または職場外の友人であること、またはある取引先担当者は以前別の取引先企業で働いていたことなどを把握しておくと便利場合があります。 ほとんどの業種では、この種の情報を使用または入力を必要とするレポートを生成しないため、エンティティ関係を作成するに値しません。 詳細: [つながりロールを構成する](configure-connection-roles.md)

  
<a name="BKMK_TypesOfRelationships"></a>
 
## <a name="types-of-entity-relationships"></a>エンティティ関係の種類
ソリューション エクスプローラーを表示すると、3 種類のエンティティ関係があると思われる場合があります。 次の表に示したとおり実際は 2 つだけです。  
  
|関係内容|内容|  
|-----------------------|-----------------|  
|**1:N (一対多)**|関連エンティティの検索フィールドを使用して、**主エンティティ**の 1 つのエンティティ レコードが他の複数の**関連エンティティ**レコードに関連付けられるエンティティ関係。<br /><br /> 主エンティティ レコードを表示する際に、それに関連付けられた関連エンティティ レコードの一覧を表示できます。<br /><br /> Power Apps ポータル では、 **現在のエンティティ** は主エンティティを表します。|  
|**N:N (多対多)**|特殊な**関係エンティティ**に基づくエンティティ関係。交差するエンティティと呼ばれることもあり、1 つのエンティティの複数のレコードが別のエンティティの複数のレコードに関連付けられます。<br /><br /> N:N の関連付けのいずれかのエンティティのレコードを表示すると、それと関連する他のエンティティのレコードのリストを表示できます。|  
  
デザイナーはエンティティでグループ分けされたビューを表示するため、**N:1 (多対 1)** の関連付けの種類はユーザー インターフェイスにあります。 1:N の関連付けは実際にはエンティティの *間* にあり、 **主エンティティ/現在のエンティティ** または **関連エンティティ**のいずれかとして各エンティティを参照します。 *子*エンティティとも呼ばれる関連エンティティには、主エンティティ (*親*エンティティとも呼ばれる) からのレコードへの参照を格納できる検索フィールドもあります。 N:1 の関連付けは、単に、関連エンティティから見た 1:N の関連付けです。  
 
## <a name="entity-relationship-behavior"></a>エンティティ関係の動作
関連エンティティの動作は、データ整合性が確保され、会社の業務プロセスを自動化できるため重要です。

### <a name="preserve-data-integrity"></a>データ整合性の維持
他のエンティティをサポートするために存在するエンティティもあります。 それらは単独では意味がありません。 通常は、サポートする主エンティティにリンクするための検索フィールドが必須です。 プライマリ レコードが削除されると、どうなりますか。

関連付けの動作を使用し、ビジネスのルールに基づいてこれを定義することができます。 2 つのオプション:

- 異なる主エンティティと関連付けることなどによって、関連するエンティティレコードを調整できるようにするため、主エンティティの削除を防止します。
- 主エンティティ レコードを削除して、関連エンティティを自動的に削除できるようにします。

関連エンティティが主エンティティをサポートしていない場合は、主エンティティを削除することができ、検索の値は消去されます。

### <a name="automate-business-processes"></a>ビジネス プロセスの自動化
新しい営業担当者がいて、別の営業担当者に割り当てている既存の取引先企業をその新しい営業担当者に割り当てると仮定します。 各取引先企業レコードには、それに関連付けられた一連タスク活動があります。 以前の所有者に再割り当てしたいまたは新しい営業担当者に割り当てたいアクティブな取引先企業を簡単に見つけることができます。 しかし、取引先企業に関連付けられているタスク活動の場合にはどうですか。 各タスクを開き、新しい営業担当者に割り当てるかどうかを一つずつ考慮したいですか。 したくないでしょう。 その代わり、関連付けが標準規則を自動的に適用するようにできます。 これらの規則は再割り当てする取引先企業に関連付けられているタスク レコードにのみ適用されます。 次のオプションがあります。  
  
- すべてのタスク活動を再割り当てします。  
- すべてのタスクを再割り当てします。 
- タスクを全く再割り当てしません。  
- 現時点では、すべてのタスクを取引先企業の以前の所有者に再割り当てします。  
  
関連付けは、主エンティティ レコードのレコードで実行された操作が関連するすべてのエンティティ レコードにどのように伝播するかを制御できます。  

### <a name="behaviors"></a>動作
特定の操作を実行するときに適用できる複数の種類の動作があります。

|動作|説明|
|--|--|
|**アクティブ レコードのみに伝播**|すべてのアクティブな関連エンティティ レコードで操作を実行します。|
|**すべてのレコードに伝播**|すべての関連エンティティ レコードで操作を実行します。|
|**伝播しない**|何もしません。|
|**関連付けの解除**|すべての関連レコードの検索値を削除します。|
|**制限する**|関連エンティティ レコードが存在するときは、主エンティティ レコードが削除されないようにします。|
|**同一所有者のレコードのみに伝播**|主エンティティ レコードと同じユーザーによって所有されているすべての関連エンティティ レコードで操作を実行します。|

### <a name="actions"></a>操作
これらは、特定の動作をトリガーできる操作です。

|フィールド|説明|Options|
|--|--|--|
|**割り当て**|主エンティティ レコードが別のレコードに割り当てられると、どうなりますか?|すべてのレコードに伝播<br />アクティブ レコードのみに伝播<br />同一所有者のレコードのみに伝播<br />伝播しない|
|**リペアレント**|上位下位の関連付けの関連エンティティの検索値が変更されると、どうなりますか。<br />詳細情報: [エンティティの上位下位の関連付け](#parental-entity-relationships)|すべてのレコードに伝播<br />アクティブ レコードのみに伝播<br />同一所有者のレコードのみに伝播<br />伝播しない|
|**共有**|主エンティティ レコードが共有されると、どうなりますか。|すべてのレコードに伝播<br />アクティブ レコードのみに伝播<br />同一所有者のレコードのみに伝播<br />伝播しない|
|**削除**|主エンティティ レコードが削除されると、どうなりますか。|すべてのレコードに伝播<br />リンクの解除<br />制限する|
|**共有の解除**|主エンティティ レコードの共有が解除されると、どうなりますか。|すべてのレコードに伝播<br />アクティブ レコードのみに伝播<br />同一所有者のレコードのみに伝播<br />伝播しない|
|**マージ**|主エンティティ レコードの共有がマージされると、どうなりますか。|すべてのレコードに伝播<br />伝播しない|
|**ロールアップ ビュー**|この関連付けに関連付けられているロールアップ ビューの希望する動作は何ですか。 |すべてのレコードに伝播<br />アクティブ レコードのみに伝播<br />同一所有者のレコードのみに伝播<br />伝播しない|

> [!NOTE]
> 次の状況では、割り当て、削除、マージ、リペアレントのアクションは実行されません。
> - 元の親レコードと要求されたアクションに同じ値が含まれている場合。 例：割当のトリガーを試行し、すでにレコードの所有者となっている担当者を選択します
> - 縦続する処理が既に実行されている親レコードに対して操作の実行を試行する

> [!NOTE]
> 割り当てを実行すると、レコードで現在アクティブなワークフローまたはビジネ スルールは、再割り当てが行われた際に自動的に非アクティブになります。 レコードの新たな所有者がワークフローまたはビジネス ルールを引き続き使用する場合は、そのワークフローまたはビジネス ルールを再度有効化する必要があります。

### <a name="parental-entity-relationships"></a>エンティティの上位下位の関連付け
1:N の関連付けを持つことができるエンティティの各ペアの間には、1:N の関連付けが複数存在する場合があります。 その場合でも、エンティティの上位下位の関連付けを考慮できるのは、通常、そのような関連付けの中の 1 つだけです。

エンティティの上位下位の関連付けは、次の表の**上位下位である**列のカスケード オプションのいずれかが真であるような、1:N のエンティティの関連付けです。

|目的|上位下位である|上位下位ではない|  
|------------|--------------|------------------|  
|**割り当て**|すべてのレコードに伝播<br />同一所有者のレコードのみに伝播<br />アクティブ レコードのみに伝播|伝播しない|  
|**削除**|すべてのレコードに伝播|リンクの解除<br />制限する|  
|**リペアレント**|すべてのレコードに伝播<br />同一所有者のレコードのみに伝播<br />アクティブ レコードのみに伝播|伝播しない|  
|**共有**|すべてのレコードに伝播<br />同一所有者のレコードのみに伝播<br />アクティブ レコードのみに伝播|伝播しない|  
|**共有の解除**|すべてのレコードに伝播<br />同一所有者のレコードのみに伝播<br />アクティブ レコードのみに伝播|伝播しない|  

たとえば、新しい顧客エンティティを作成し、取引先企業エンティティとの 1:N のエンティティ関係を追加して、顧客エンティティが関連エンティティである場合、**上位下位である**列のオプションを使用するように、そのエンティティ関係に対する操作を構成できます。 後で、顧客エンティティとの別の 1:N エンティティ関係を、顧客エンティティを参照元エンティティとして追加する場合は、**上位下位ではない**列のオプションを使用するような操作だけを構成できます。

通常、これは各エンティティ ペアには上位下位の関連付けが 1 つだけ存在することを意味します。 複数の種類のエンティティに対して、関連エンティティでの関連付けの検索を実行できる場合があります。

たとえば、エンティティに顧客検索がある場合、取引先担当者または取引先企業エンティティを参照できます。 2 つの異なる上位下位の 1:N エンティティ関係が存在します。

すべての活動エンティティには、関係する検索フィールドを使用して関連付けることができるエンティティに対する、似た一連のエンティティの上位下位の関連付けがあります。

<a name="BKMK_RelationshipBehaviorLimitations"></a>   

### <a name="limitations-on-behaviors-you-can-set"></a>設定できる動作の制限
上位下位の関連付けのため、エンティティ関係を定義するときを覚えておく必要があるいくつかの制限があります。  
  
- 伝播する関連システム エンティティとの関連付けにおいて、ユーザー定義エンティティを主エンティティにすることはできません。 つまり、主ユーザー定義エンティティと関連システム エンティティの間の関連付けには、**すべてのレコードに伝播**、**アクティブ レコードのみに伝播**、または**同一所有者のレコードのみに伝播**のアクションを設定できません。  
- アクションが**すべてのレコードに伝播**、**アクティブ レコードのみに伝播**、または**同一所有者のレコードのみに伝播**に設定された別の関連付けの関連エンティティとして、新しい関連付けの関連エンティティが既に存在する場合、新しい関連付けのアクションを**すべてのレコードに伝播**、**アクティブ レコードのみに伝播**、または**同一所有者のレコードのみに伝播**に設定することはできません。 これにより、複数の親関連付けを持つ関連付けの作成を防ぎます。  

### <a name="see-also"></a>関連項目
[エンティティおよびメタデータの概要](create-edit-metadata.md)<br />
[1:N (一対多) または N:1 (多対一) の関連付けを作成および編集する](create-edit-1n-relationships.md)<br />
[多対多 (N:N) のエンティティの関連付けを作成する](create-edit-nn-relationships.md)

