---
title: 依存関係の削除 (Common Data Service) | Microsoft Docs
description: 依存関係により、操作がブロックされる場合があります。 この記事では、依存関係を削除する方法について説明します。
ms.custom: ''
ms.date: 04/28/2018
ms.reviewer: ''
ms.service: powerapps
ms.topic: article
author: ccdietrich
ms.author: cdietric
manager: shmcarth
search.audienceType:
- developer
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 3c0227ac41dce2fe28f27d1ac92401fa4d6f476d
ms.sourcegitcommit: 94d66a2e1bc7f45f1a8ae97cc5ec4fce89aefdee
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/30/2020
ms.locfileid: "3325707"
---
# <a name="removing-dependencies"></a>依存関係の削除

依存関係は、アクションを防ぐためソリューション フレームワークによって自動的に作成されるレコードで、チェックされずに実行すると問題が発生する可能性があります。 コンポーネントが変更および拡張されると、依存関係が作成され、たとえばフォームが機能するためにフィールドが必要であることを示します。
そのフィールドを削除するアクションを実行しようとすると、フォームが機能しなくなります。

依存関係は、1 つ以上の依存コンポーネントがまだ参照できる間、必須コンポーネントが削除されないようにするために存在します。

> [!NOTE]
> このドキュメントのコンテキストで使用される*削除*という語は、システムからコンポーネントを完全に削除することとして理解する必要があります。

この記事では、これらの依存関係を処理する方法と、不要になった依存関係を削除するために使用できる戦略について説明します。

まず、依存関係によって必須コンポーネントを削除する操作のみが防止され、コンポーネントを削除できるアクションはその状態によって異なることを明確にすることが重要です:

- **アンマネージド**: この状態のコンポーネントは、アクティブ ソリューションでの単一のレイヤーで表されます。 コンポーネントで任意の**削除**操作をすると、コンポーネントが完全に削除されます。

 - **マネージド**: マネージド コンポーネントの削除は、ソリューションのレイヤー数、アンインストールされる層の相対位置、コンポーネント公開元など、複数の要因に依存します。 たとえば、コンポーネントが削除された場合、以下のシナリオおよびアンインストール時に予想されることを考慮してください:

     ![単一のレイヤーでアンインストール](media/solution-managed-uninstall-scenario-01.png "単一のレイヤーでアンインストール")

    - ソリューション 1 - コンポーネントの唯一のレイヤーであるため、コンポーネントが削除されます。

    ![2 つのレイヤーでアンインストール - 異なる公開元](media/solution-managed-uninstall-scenario-02.png "2 つのレイヤーでアンインストール - 異なる公開元")

    - ソリューション 2 - コンポーネントは削除されません。 そのレイヤーのみが削除されます。
    - ソリューション 1 - アクションが基本レイヤーで発生するため、コンポーネントが削除されます。 実際に、コンポーネントを拡張する別の発行元からのソリューションがあるため、この場合ソリューション 1 はアンインストールできません。

    ![複数レイヤーでアンインストール - 異なる公開元](media/solution-managed-uninstall-scenario-03.png "複数レイヤーでアンインストール - 異なる公開元")
    
     - ソリューション 3 - コンポーネントは削除されません。 そのレイヤーのみが削除されます。
     - ソリューション 2 - コンポーネントは削除されません。 そのレイヤーのみが削除されます。
     - ソリューション 1 - コンポーネントは削除されません。 この場合、同じ発行元からの別のソリューションがあります (ソリューション 3)。 プラットフォームはソリューション 1 からレイヤーを削除し、ソリューション 3 からのレイヤーに置き換えます。

    ![2 レイヤ―でアンインストール - アンマネージド カスタマイズ](media/solution-managed-uninstall-scenario-04.png "2 レイヤ―でアンインストール - アンマネージド カスタマイズ")

      - アクティブ - コンポーネントは削除されません。 そのレイヤーのみが削除されます。 アクティブなソリューションをアンインストールすることはできませんが、**アクティブなカスタマイズの削除**機能を使用してコンポーネントを削除できることを確認します。
      - ソリューション 1 - コンポーネントは削除されます。 アクションは基本レイヤーで発生します。 シナリオ 2 とは異なり、ソリューション 1 をアンインストールできます。 アクティブなソリューションは拡張とは見なされず、両方の行が削除されます。

## <a name="dependency-dialog"></a>依存関係ダイアログ

依存関係ダイアログでは、選択したソリューションの依存関係を一覧表示できます。 次の方法で呼び出すことができます:

- ソリューションのページで**依存関係の表示**ボタンをクリックします。
- ソリューションをアンインストールしようとすると、プラットフォームは存在する依存関係を検出します。

たとえば、次のようなものです。

![依存関係による依存関係ダイアログ](media/dependency-dialog-with-dependencies.png "依存関係による依存関係ダイアログ")

**依存関係の詳細**ダイアログには、次に説明する 6 つの列があります:

- **表示名**: 必須コンポーネントのフレンドリ名。 各コンポーネントでは、識別を容易にするため、わずかに異なるデータが表示されることがあります。 図の例では、エンティティには名前のみがあり、フィールドには名前および親エンティティの名前があることを確認できます。
- **名前/ID**: 必須コンポーネントの内部名。
- **タイプ**: 必須コンポーネントのタイプ。
- **要求元**: それを必要とするコンポーネント (依存コンポーネント) のフレンドリ名。 コンポーネントにカスタマイズ ページがある場合、そのページを開くリンクに変わります。
- **依存タイプ**: 依存コンポーネントのタイプ。
- **ソリューション レイヤー**: 依存関係に関係するコンポーネントの詳細を確認できるリンク。

> [!NOTE]
> 必須コンポーネントは、削除するコンポーネントです。 依存コンポーネントは、必須コンポーネントへの参照があるコンポーネントです。 依存関係を削除するには、必須コンポーネントではなく、依存コンポーネントに影響する変更を加える必要があります。

## <a name="diagnosing-dependencies"></a>依存関係の診断

次のシナリオを検討しましょう。 以下の組織には、2 つのソリューションがあります: "ソリューション - ワークフロー" および "ソリューション - ユーザー定義エンティティ"。

![2 つのソリューションを含むソリューション リスト](media/solution-list-custom-entity-workflow.png "2 つのソリューションを含むソリューション リスト")

組織の所有者は、"ソリューション - ユーザー定義エンティティ" が不要になったと判断し、削除を試みると、次のダイアログが表示されました:

![依存関係による依存関係ダイアログ](media/dependency-dialog-with-dependencies.png "依存関係による依存関係ダイアログ")

詳細には触れずに、ソリューションのアンインストールが "ユーザー定義エンティティ" というエンティティと、3 つのフィールド "ユーザー定義エンティティ"、"名前"、"数値フィールド" を削除しようとしていると結論付けることができます。これら 4 つのコンポーネントすべてに依存関係があります。

> [!NOTE]
> ソリューションが多くのコンポーネントを削除する可能性がありますが、依存関係がないため、リストに表示されません。

次のステップは、各依存関係のソリューションの階層 (右端の列にあるリンク) を確認することです。 これは、依存関係を削除するのに必要なアクションを定義するのに役立ちます。

エンティティ (ユーザー定義エンティティ) およびプロセス (テスト ワークフロー):

![エンティティ (ユーザー定義エンティティ) とワークフロー (マイ アプリ) 間の依存関係](media/solution-dependency-solution-history-02.png "エンティティ (ユーザー定義エンティティ) とサイト マップ (マイ アプリ) 間の依存関係")

表示されるデータに基づいて、依存コンポーネントが SolutionWorkflow と呼ばれるソリューションに属していることを確認できます。 この依存関係を削除するには、次のいずれかを実行できます:

- エンティティまたはそのサブコンポーネントへの任意の参照を削除して、SolutionWorkflow でワークフローの定義を更新します。 その後ソリューションを**更新**または**アップグレード**します。
- SolutionWorkflow ソリューションをアンインストールします。
- SolutionWorkflow ソリューションの新しいバージョンからワークフローを削除し、**アップグレード**を実行します。

1 つの依存コンポーネントでソリューションの削除を停止できるため、すべての依存関係を確認し、必要なすべての変更を 1 回の操作で実行することをお勧めします。

エンティティ (ユーザー定義エンティティ) およびモデル駆動型アプリ (マイ アプリ):

![エンティティ (ユーザー定義エンティティ) とサイト マップ (マイ アプリ) 間の依存関係](media/solution-dependency-solution-history-01.png "エンティティ (ユーザー定義エンティティ) とサイト マップ (マイ アプリ) 間の依存関係")

表示されるデータに基づいて、依存コンポーネントがアクティブと呼ばれるソリューションに属していることを確認できます。 これは、アンマネージド ソリューションをインポートすることによって、または最新の UI または API を通じて実行されたアンマネージド カスタマイズによって、依存関係が作成されたことを示しています。

この依存関係を削除するには、次のいずれかを実行できます:

- モデル駆動型アプリの定義を編集して、エンティティまたはそのサブコンポーネントへの任意の参照を削除します。 モデル駆動型アプリは公開をサポートしているため、変更を公開する必要があります。
- モデル駆動型アプリを削除します。

> [!NOTE]
> アンマネージド ソリューションはコンポーネントをグループ化するための手段に過ぎないため、アンマネージド ソリューションをアンインストールしても、この依存関係を削除することはできません。

## <a name="actions-to-remove-a-managed-dependency"></a>管理された依存関係を削除するアクション

管理された依存関係は、依存コンポーネントがマネージド ソリューションに関連付けられている依存関係です。 この種類の依存関係を解決するには、コンポーネントが追加されたソリューションを操作する必要があります。 そのアクションは、実行しようとしている操作によって異なります:

- ソリューションをアンインストールしようとしている場合:

    1. ターゲット組織で、ソリューション レイヤー リンクを調べて、依存コンポーネントのリストで最上位のソリューションを見つけます。
    1. ソース組織で、ソリューションの新しいバージョンを準備します: ソリューションに依存コンポーネントが含まれていないか、必須コンポーネントへの参照が含まれていない依存コンポーネントの更新バージョンがあります。 目標は、ソリューションの新しいバージョンで必須コンポーネントへの任意の参照を削除することです。
    1. ソリューションの新しいバージョンをエクスポートします。
    1. ターゲット組織で、そのソリューションを**アップグレード**します。

次に、アンインストールを再試行します。

- ソリューションをアップグレードしようとしている場合: この場合、必須コンポーネントの削除が意図的なアクションであることを確認する必要があります (依存関係は削除しているコンポーネントにのみ適用されることに留意してください)。

  意図的ではなかった場合は、コンポーネントを追加してソリューションの新しいバージョンを修正するのが正しいアプローチと言えます。 そのためには、次のことを実行する必要があります:

    1. ターゲット組織で、ステージングされるソリューション (_Upgrade で終わるソリューション) をアンインストールします。
    2. ソース組織で、必須コンポーネントをソリューションに追加します。
    3. 新しいバージョンをエクスポートします。
    4. アップグレードを再試行します。

  意図的に削除する場合は、依存関係を削除する必要があります。 可能な手順は、前の箇条書きで概説したものと同じです。

### <a name="layers-and-dependencies"></a>レイヤーと依存関係

依存コンポーネントを階層化できるため、依存関係を完全に削除するには、複数のソリューションの変更が必要になる場合があります。 依存関係のフレームワークは、必須コンポーネントと依存コンポーネントの最上位レイヤー間の依存関係のみを計算します。 つまり、依存コンポーネントのソリューションの最上位から最下位に向かって作業する必要があります。

次のシナリオを確認してください。

![エンティティ (ユーザー定義エンティティ) とサイト マップ (マイ アプリ) 間の依存関係](media/solution-dependency-multiple-layers.png "エンティティ (ユーザー定義エンティティ) とサイト マップ (マイ アプリ) 間の依存関係")

"ソリューション - ユーザー定義エンティティ" をアンインストールしようとすると、依存関係によって操作がブロックされます。

![ソリューション - ユーザー定義エンティティのアンインストールをブロックしている依存関係](media/solution-dependency-layers-and-dependencies-dependency-dialog-01.png "'ソリューション - ユーザー定義エンティティ' のアンインストールをブロックしている依存関係")

依存関係の診断を開始するには、属性 (new_numberfield) とワークフロー (テスト ワークフロー) の "ソリューション レイヤー" をクリックします。 次の画面を確認してください:

![属性 (new_numberfield) とワークフロー (テスト ワークフロー) 間の依存関係](media/solution-dependency-layers-and-dependencies-solution-history-01.png "属性 (new_numberfield) とワークフロー (テスト ワークフロー) 間の依存関係")

依存関係は各コンポーネントの最上位レイヤー間でのみ作成されるため、最初のステップは SolutionCustomEntity の属性 (new_numberfield) と SolutionWorkflow3 のワークフロー (テスト ワークフロー) 間の依存関係を処理することです。

依存関係を削除するため、SolutionWorkflow3 をアンインストールすることに決定しました。 実行しましたが、もう一度ソリューションのアンインストールを再試行すると、同じダイアログが表示されます:

![ソリューション - ユーザー定義エンティティのアンインストールをブロックしている依存関係](media/solution-dependency-layers-and-dependencies-dependency-dialog-02.png "'ソリューション - ユーザー定義エンティティ' のアンインストールをブロックしている依存関係")

しかし、もっと多くのレイヤーがあったとしても、属性 (new_numberfield) は一覧表示されなくなりました。

## <a name="actions-to-remove-an-unmanaged-dependency"></a>管理されていない依存関係を削除するアクション

管理されていない依存関係を削除するには、コンポーネントが属するソリューションではなく、コンポーネントでの直接の操作が必要です。 たとえば、属性とフォーム間の依存関係を削除する場合、フォーム エディターで属性を編集して、フォームから属性を削除する必要があります。 **保存**および**公開**の選択後に、依存関係が削除されます。

> [!NOTE]
> また依存コンポーネントを削除することもできます。 このアクションにより、コンポーネントとともにすべての依存関係が削除されます。

コンポーネントの依存関係を確認するには、カスタマイズ ページでコンポーネントを見つけ、**依存関係の表示**をクリックする必要があります。

たとえば、次のフィールドを指定します:

![依存関係の表示](media/solution-dependency-layers-and-dependencies-component-show-dependencies.png "依存関係の表示")

ダイアログには 2 つの異なる部分があります:

![コンポーネント依存関係](media/solution-dependency-layers-and-dependencies-component-dependency-dialog.png "コンポーネントの表示")

  - 依存コンポーネント: 選択したフィールドに依存するコンポーネントの一覧。 つまり、この F=field が必須コンポーネントとなるコンポーネント。
  - 必須コンポーネント: このフィールドが機能するために必要なコンポーネントの一覧。 つまり、このフィールドが依存コンポーネントとなるコンポーネント。

最も一般的なシナリオ: (必須および依存)

## <a name="field-and-workflow"></a>フィールドおよびワークフロー

フィールド (属性) とワークフロー (プロセス) 間の依存関係を削除するには、**カスタマイズ** ページでワークフローを見つける必要があります。

ワークフローを開いた状態で、ワークフローが依存しなくなったコンポーネントへの参照を見つける必要があります。 この例では、ステップで参照されているフィールド (数値フィールド) を確認できます:

![ワークフローの編集](media/solution-dependency-component-workflow.png "ワークフローの編集")

ステップを削除 (または変更) してから、ワークフローを保存します。

## <a name="field-and-view"></a>フィールドおよびビュー

フィールド (属性) とビュー (保存済みクエリ) 間の依存関係を削除するには、**カスタマイズ** ページでビューを見つける必要があります。

フィールド エディターで、ビューが依存しなくなったコンポーネントへの参照を見つけます。 この例では、選択列およびフィルターとして使用されているフィールド (数値フィールド) が確認できます。

![ビューの編集](media/solution-dependency-component-view.png "ビューの編集")

両方を削除し、保存してから、ビューを公開します。

## <a name="entity-and-model-driven-apps"></a>エンティティおよびモデル駆動型アプリ

エンティティとモデル駆動型アプリ (アプリ モジュール) 間の依存関係を削除するには、最新 UI の**アプリ** リストでアプリを見つける必要があります。

![アプリ リスト](media/solution-dependency-component-appmodule-01.png "アプリ リスト")

エディターで、アプリが依存しなくなったコンポーネントへの参照を見つけます。 この例では、**エンティティ ビュー**でエンティティ (ユーザー定義エンティティ) が表示されます。

![アプリ エディター](media/solution-dependency-component-appmodule-02.png "アプリ エディター")

参照が見つかる可能性が高いため、アプリに関連付けられているサイト マップも調べてください:

![サイト マップのエディター](media/solution-dependency-component-appmodule-03.png "アプリ マップ エディター")

すべての参照を削除し、両方を保存して公開します (アプリとサイト マップ)。

> [!NOTE]
> 編集後、コンポーネントを管理ソリューションに追加し、他の組織に転送して、管理されている依存関係を削除できます。
  
### <a name="see-also"></a>関連項目  
 [Dynamics 365 ソリューションを使用した拡張機能のパッケージ化および配布](/dynamics365/customer-engagement/developer/package-distribute-extensions-use-solutions)   
 [ソリューションの概要](introduction-solutions.md)   
 [ソリューション開発の計画](/dynamics365/customer-engagement/developer/plan-solution-development)   
 [アンマネージド ソリューションの作成、エクスポート、またはインポート](create-export-import-unmanaged-solution.md)   
 [マネージド ソリューションの作成、インストール、および更新](create-install-update-managed-solution.md)   
 [マネージド ソリューションの作成、インストール、および更新](create-install-update-managed-solution.md)   
 [ソリューションのアンインストールまたは削除](uninstall-delete-solution.md)   
 [ソリューション エンティティ](/dynamics365/customer-engagement/developer/solution-entities)
