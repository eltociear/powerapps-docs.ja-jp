---
title: データの同期 (Common Data Service) | Microsoft Docs
description: <Description>
ms.custom: ''
ms.date: 10/31/2018
ms.reviewer: ''
ms.service: powerapps
ms.topic: article
author: JimDaly
ms.author: jdaly
manager: ryjones
search.audienceType:
- developer
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 336feb97b011e3a8a9027dae8001c42641aa8276
ms.sourcegitcommit: 8185f87dddf05ee256491feab9873e9143535e02
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/01/2019
ms.locfileid: "2748992"
---
# <a name="data-synchronization"></a>データの同期

Common Data Service のデータを、他のシステムに格納されているデータと同期させて、統合することが必要な場合があります。 一般的なデータ統合パターンには、外部システムからのデータの取得と Common Data Service へのそのデータの転送、Common Data Service からのデータの取得とそのデータと外部データ ストアとの同期、または外部データによる Common Data Service の更新が含まれています。 現在は、複数の新機能を使用して、これらのシナリオを実現するコードの記述がより簡単になっています。  

 これらの新機能はどの状況でも必要に応じて別々に使用できますが、外部データとのデータの同期および統合に関連する共通の問題に組み合わせで対処できます。 次の表に、これらの新機能を紹介します。  


|            機能            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 特定のメッセージを削除する |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Common Data Service には、レコードを更新する個別の操作に対応した複数の特定のメッセージがあります。 これらのメッセージはこのリリースで廃止され、現在は、同じ操作を実行するために `Update` を使用するだけです。 削除されたメッセージを以下に示します。<br /><br /> -   割り当て<br />-   SetParentSystemUser<br />-   SetParentTeam<br />-   SetParentBusinessUnit<br />-   SetBusinessEquipment<br />-   SetBusinessUnit<br />-   SetState<br /><br /> 単にレコードを更新することは、これらのメッセージを使用するよりも簡単であり、データの統合と同期のシナリオに対する開発を効率化することになります。 詳細については、[更新を使用して特化された操作を実行する](/dynamics365/customer-engagement/developer/org-service/perform-specialized-operations-using-update)を参照してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|        代替キー         | Common Data Service のエンタープライズ展開では、外部エンタープライズ システムからのデータを、ユーザーに提供できるように、Common Data Service にロードすることが一般的です。 これら外部システムは、システムの同期に必要な GUID と呼ばれる、Common Data Service レコード ID を格納するように拡張することができないことがよくあります。 一般的なソリューションは、外部システムに関連レコードの ID を格納するために使用できる Common Data Service に、ユーザー定義のエンティティを追加することです。<br /><br /> Common Data Service でレコードを更新し、Common Data Service で関連レコードへの参照を割り当てるデータ ロード プロセスを作成するときは、まず追加の Common Data Service の Web サービスを呼び出し、この外部の識別子に基づいて Common Data Service の目標レコードを取得する必要があります。 この検索は、適切なインデックスがユーザー定義属性の適切な場所にない場合は遅くなる可能性があり、Common Data Service のシナリオでは、これらの検索のそれぞれで、コストのかかるインターネット上のラウンド トリップが必要になります。 これらの余分なラウンド トリップは、Common Data Service の各レコードの更新に必要な時間の桁数に応じて増大し、総合的な処理能力を劇的に低下させる一可能性があります。<br /><br /> 現在は、Web サービスの操作は、GUID の代わりに、1 つまたは複数の代替キーを使用して、Common Data Service のレコードを対象にすることができます。 また、関連レコードへのエンティティ参照を、1 つまたは複数の代替キーを使用して指定できます。 代替キーはインデックス付きなので、ユーザー定義属性を識別子として追加することと比較して、検索操作のパフォーマンスの向上が見られます。 何か問題がある場合は、システムはエラーをスローして、すべての変更をロールバックします。 詳細については、[エンティティの代替キーの定義](define-alternate-keys-entity.md)を参照してください。 |
|        変更の追跡        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         組織が Common Data Serviceデータを外部ストレージに維持する必要があるときは、データの最初の抽出後、または最後の同期後に変更されたデータを検出することによって、効率の良い方法でデータの同期を維持する方法を現在提供しています。 エンティティの変更が取得には、<xref:Microsoft.Xrm.Sdk.Messages.RetrieveEntityChangesRequest> メッセージを使用します。 詳細については、[変更の追跡を使用してデータを外部システムに同期](use-change-tracking-synchronize-data-external-systems.md) を参照してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|            upsert             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 外部システムから Common Data Service にデータを読み込むとき、レコードが Common Data Service に既に存在しているか、そして更新する必要があるかどうか、または新しいレコードを作成する必要があるかどうかが分からない場合があります。 新しい <xref:Microsoft.Xrm.Sdk.Messages.UpsertRequest> メッセージを使用して、1 回の API 呼び出しで、存在する場合はレコードを更新し、存在しない場合は新しいレコードを作成します。 詳細については、[Upsert を使用して Dynamics 365 を外部データで更新](use-upsert-insert-update-record.md)を参照してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

 次の表は、これらの新しい機能を使用した場合と使用しない場合の同期の複雑度の比較です。  


|                                                       次の日付より前                                                        |                                                                                                                                                                                                                                                                                                                     説明                                                                                                                                                                                                                                                                                                                      |
|---------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ![特定のメッセージを使用する更新プログラム](media/before-carina-dynamics-crm-2015.png "特定のメッセージを使用する更新プログラム") | 各レコードに対して以下を実行します。<br /><br /> 1.  Common Data Service をクエリして、取引先企業が存在するかどうかを確認します。 存在する場合は、その取引先企業 ID (たとえば、ABC123) を取得します<br />2.  取引先担当者をクエリして、取引先担当者が存在することを確認します。 存在する場合は、取引先担当者の電子メール ID (例えば contact@company.com) を取得します。<br />3.  地域 ID (たとえば、NW) を取得または設定するためにクエリします。<br />4.  所有者を設定するためのユーザー ID を取得するためのクエリ (例えば user@mycompany.com)<br />5.  取引先企業を更新します。<br />6.  `SetState` API を呼び出して、取引先企業の状態を設定します。<br />7.  `Assign` API を呼び出して、所有者を割り当てます。 |

 現在は、この新機能により、前述と同じ操作を実行するのに必要なサーバーへの呼び出しは 1 回だけです。  


|                                                After                                                 |                                                                                                   説明                                                                                                   |
|------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ![UpdateRequest による更新](media/after-carina-dynamics-crm-2015.png "UpdateRequest による更新") | 1 回の呼び出しだけで、一意の ID ABC123 を持つ取引先企業の存在を検証するには、取引先責任者を contact@company.com に、地域を NW に、所有者を user@mycompany.com に、状態をアクティブに設定します。 |

## <a name="in-this-section"></a>このセクションの内容  
 [エンティティの代替キーの定義](define-alternate-keys-entity.md)<br />
 [代替キーの使用](use-alternate-key-create-record.md)<br />
 [変更の追跡を使用してデータを外部システムに同期](use-change-tracking-synchronize-data-external-systems.md)<br />
 [Upsert を使用して Dynamics 365 を外部データで更新](use-upsert-insert-update-record.md)<br />
 [サンプル: Upsert を使用してレコードを挿入または更新](/dynamics365/customer-engagement/developer/sample-insert-update-record-upsert)<br />
 [サンプル: 変更の追跡を使用してデータを外部システムに同期](/dynamics365/customer-engagement/developer/sample-synchronize-data-external-systems-using-change-tracking)<br /> 

## <a name="related-sections"></a>関連セクション  
 [[更新] を使用して特化された操作を実行する](/dynamics365/customer-engagement/developer/org-service/perform-specialized-operations-using-update)<br /> 
 [Dynamics 365 用カスタマイズの開発者ガイド](/dynamics365/customer-engagement/developer/customize-dev/customize-applications)<br /> 